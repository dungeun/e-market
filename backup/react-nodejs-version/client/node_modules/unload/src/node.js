// set to true to log events
const DEBUG = false;

function add(fn) {
    process.on('exit', () => {
        DEBUG && 
        return fn();
    });

    /**
     * on the following events,
     * the process will not end if there are
     * event-handlers attached,
     * therefore we have to call process.exit()
     */
    process.on('beforeExit', () => {
        DEBUG && 
        return fn().then(() => process.exit());
    });
    // catches ctrl+c event
    process.on('SIGINT', () => {
        DEBUG && 
        return fn().then(() => process.exit());
    });
    // catches uncaught exceptions
    process.on('uncaughtException', err => {
        DEBUG && 
        return fn()
            .then(() => {

                process.exit(1);
            });
    });
}

export default {
    add
};

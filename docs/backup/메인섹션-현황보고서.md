# 메인 섹션 현황 보고서

**작성일:** 2025-09-02  
**작성자:** Claude Code  
**프로젝트:** commerce-nextjs  

---

## 📊 시스템 개요

### 환경 정보
- **Next.js**: 15.4.6 (App Router)
- **Database**: PostgreSQL (Podman 컨테이너)
- **Redis**: Redis 7 (Podman 컨테이너)
- **Development Server**: http://localhost:3002

### 컨테이너 상태
```bash
CONTAINER       STATUS           PORTS
commerce-postgres  Up 46 hours   0.0.0.0:5434->5432/tcp
commerce-redis     Up 46 hours   0.0.0.0:6381->6379/tcp
```

---

## 🗄️ 데이터베이스 현황

### UI 섹션 테이블 (`ui_sections`)
**총 12개 섹션 저장됨**

| name | type | order | isActive | config 내용 요약 |
|------|------|-------|----------|------------------|
| **hero** | hero | 1 | ✅ | 2개 슬라이드: "특별한 혜택", "신규 회원 혜택" |
| **히어로 배너** | hero | 1 | ✅ | 1개 슬라이드: "최고의 온라인 쇼핑" |
| **category** | category | 2 | ✅ | 6개 카테고리: 뷰티, 패션, 식품, 전자제품, 라이프스타일, 스포츠 |
| **추천 상품** | featured-products | 2 | ✅ | 8개 제품 표시, 카테고리 표시 |
| **quicklinks** | quicklinks | 3 | ✅ | 4개 바로가기: 특가, 신상품, 베스트, 기획전 |
| **카테고리 섹션** | categories | 3 | ✅ | 그리드 레이아웃, 개수 표시 |
| **promo** | promo | 4 | ✅ | 여름 시즌 세일 배너 |
| **인기 상품** | popular-products | 4 | ✅ | 6개 인기상품, 인기도순 정렬 |
| **ranking** | ranking | 5 | ✅ | 실시간 인기 상품 섹션 |
| **특가 상품** | sale-products | 5 | ✅ | 4개 특가상품, 할인 표시 |
| **recommended** | recommended | 6 | ✅ | AI 추천 섹션 |
| **featured-products** | featured-products | 7 | ✅ | 이달의 특가 상품 섹션 |

### 언어팩 테이블 (`language_packs`)
**총 12개 언어팩 (4개 키 × 3개 언어)**

```sql
namespace | key         | languageCode | value
----------|-------------|--------------|------------------
common    | add_to_cart | ko/en/jp     | 장바구니에 추가/Add to Cart/カートに追加
header    | cart        | ko/en/jp     | 장바구니/Cart/カート
header    | home        | ko/en/jp     | 홈/Home/ホーム  
header    | products    | ko/en/jp     | 제품/Products/製品
```

---

## 🚨 발견된 주요 문제점들

### 1. 중복 섹션 및 Order 충돌 문제
```
❌ hero (order: 1) + 히어로 배너 (order: 1) ← 중복!
❌ category (order: 2) + 추천 상품 (order: 2) ← 중복!  
❌ quicklinks (order: 3) + 카테고리 섹션 (order: 3) ← 중복!
❌ promo (order: 4) + 인기 상품 (order: 4) ← 중복!
❌ ranking (order: 5) + 특가 상품 (order: 5) ← 중복!
```

**영향:** 렌더링 순서가 예측 불가하고, 중복 콘텐츠 표시 가능성

### 2. API 데이터 읽기 실패
```json
// ❌ 현재 API 응답 (/api/home/sections?lang=ko)
{
  "sections": [
    {"id": 1, "type": "hero", "data": {}, "config": {}}, // 빈 데이터!
    {"id": 6, "type": "hero", "data": {}, "config": {}}, // 빈 데이터!
    ...
  ]
}
```

**원인:** `UISectionService.getVisibleSections()` 함수가 DB의 `config` 필드를 제대로 읽지 못함

### 3. 섹션 ID/Key 매핑 불일치
- **DB 저장:** `name` 컬럼 사용
- **API 응답:** `key` 필드 누락
- **Frontend:** `section.id` 기준 매칭 시도

### 4. 언어팩 부족
- 헤더 관련 4개 키만 존재
- 섹션별 제목/설명 언어팩 없음
- 메인 페이지 UI 텍스트 언어팩 부족

---

## 🎯 컴포넌트 구조 분석

### 사용 가능한 섹션 컴포넌트 (24개)
```
components/sections/:
✅ HeroSection.tsx (히어로 배너)
✅ CategorySection.tsx (카테고리)  
✅ QuickLinksSection.tsx (바로가기)
✅ PromoSection.tsx (프로모션)
✅ RankingSection.tsx (랭킹)
✅ RecommendedSection.tsx (추천)
✅ FeaturedProducts.tsx (추천상품)
✅ BestSellers.tsx, BrandSpotlight.tsx
✅ FlashSale.tsx, InstagramFeed.tsx
... 및 기타 15개 컴포넌트
```

### HomeSections 렌더링 구조
```typescript
// components/main/HomeSections.tsx
export default function HomeSections({ children, sectionOrder }) {
  // 1. useOptimizedUILocalization 훅으로 데이터 로드
  // 2. API에서 받은 섹션 순서대로 정렬
  // 3. switch문으로 섹션별 컴포넌트 매칭
  // 4. children prop에서 해당 섹션 렌더링
}

// 기본 섹션 순서 (하드코딩)
[
  { id: "hero", type: "hero", order: 1 },
  { id: "category", type: "category", order: 2 },
  { id: "quicklinks", type: "quicklinks", order: 3 },
  { id: "promo", type: "promo", order: 4 },
  { id: "featured-products", type: "featuredProducts", order: 5 },
  { id: "ranking", type: "ranking", order: 6 }
]
```

---

## 🔗 데이터 흐름 분석

### 현재 데이터 흐름
```
DB (ui_sections) 
  ↓ config 필드에 JSON 저장
UISectionService.getVisibleSections()
  ↓ ❌ 빈 객체 {} 반환
/api/home/sections API
  ↓ ❌ data: {}, config: {} 
useOptimizedUILocalization Hook
  ↓ ❌ 빈 데이터
HomeSections Component
  ↓ ❌ 섹션 렌더링 실패
Main Page (빈 스켈레톤만 표시)
```

### 예상 정상 흐름
```
DB (ui_sections)
  ↓ config 필드의 JSON 파싱
UISectionService.getVisibleSections()  
  ↓ ✅ 실제 섹션 데이터 반환
/api/home/sections API
  ↓ ✅ 올바른 data/config
useOptimizedUILocalization Hook
  ↓ ✅ 섹션 데이터 + 순서
HomeSections Component  
  ↓ ✅ 각 섹션 컴포넌트 렌더링
Main Page (완전한 홈페이지)
```

---

## 📋 해결 필요 사항 (우선순위별)

### 🔴 긴급 (P0)
1. **API 데이터 읽기 수정**
   - `UISectionService.getVisibleSections()` 함수 수정
   - DB `config` 필드를 올바르게 파싱하여 반환

2. **중복 섹션 정리**
   - 중복된 hero 섹션 중 하나 제거
   - Order 값 재배정 (1-12 고유값)

### 🟡 중요 (P1)  
3. **섹션 ID 매핑 통일**
   - DB `name` ↔ API `key` ↔ Frontend `id` 일치
   - 섹션 식별자 표준화

4. **언어팩 확장**
   - 섹션별 제목/설명 언어팩 추가
   - 메인 페이지 UI 텍스트 다국어 지원

### 🟢 개선 (P2)
5. **성능 최적화**
   - Redis 캐싱 활용
   - 섹션 데이터 캐시 전략 수립

6. **관리자 도구 개선**
   - 섹션 순서 관리 UI 개선
   - 중복 방지 기능 추가

---

## ✅ 정상 작동 부분

- ✅ Podman PostgreSQL/Redis 컨테이너 정상 운영
- ✅ Next.js 개발 서버 실행 (포트 3002)
- ✅ 데이터베이스 연결 및 테이블 구조 완성
- ✅ 24개 섹션 컴포넌트 파일 구비
- ✅ HomeSections 렌더링 구조 완성
- ✅ API 엔드포인트 정상 응답
- ✅ React Query 기반 캐싱 시스템
- ✅ 다국어 지원 기반 구조
- ✅ 팝업 알림 시스템 (완벽 작동)

---

## 🎯 결론

**현재 상태:** 
- 시스템 구조와 컴포넌트는 완성되어 있음
- DB에 섹션 데이터 저장 완료
- **핵심 문제:** API가 DB 데이터를 제대로 읽어오지 못함

**해결 후 기대 효과:**
- 12개 섹션이 메인 페이지에 정상 표시
- 다국어 지원으로 글로벌 서비스 가능
- 관리자 패널에서 실시간 섹션 관리

**추정 수정 시간:** 
- P0 긴급 수정: 1-2시간
- P1 중요 개선: 2-3시간  
- P2 성능 최적화: 3-4시간

---

*본 문서는 수정 작업 전 현황 파악을 위해 작성되었으며, 실제 코드 수정은 별도 승인 후 진행 예정입니다.*
# 🚀 언어 시스템 통합 실행 계획

## 📅 작성일: 2025-09-02
## 🎯 목적: 분산된 언어 시스템 통합 및 정리를 위한 실무 실행 계획

---

## 1. 📊 현재 상태 분석 결과

### 1.1 API 디렉토리 현황 (5개 분산)
```
/app/api/admin/
├── language-pack-keys/      # 언어팩 키 관리
├── language-packs/           # 언어팩 CRUD (메인)
│   ├── route.ts
│   ├── [key]/route.ts
│   ├── auto-translate/route.ts
│   └── translate/route.ts
├── languages/                # 언어 설정
│   ├── route.ts
│   ├── settings/route.ts    # ✅ 이미 구현된 언어 설정 API
│   ├── switch/route.ts
│   └── replace/route.ts
├── translate-settings/       # Google API 설정 ✅ 구현됨
└── translations/             # 번역 관리 (중복)
    ├── route.ts
    ├── [id]/route.ts
    ├── auto/route.ts
    ├── batch/route.ts
    └── settings/route.ts
```

### 1.2 서비스 파일 현황 (6개 중복)
```
/lib/
├── services/
│   ├── language-manager.ts ✅        # 메인 언어 관리 (유지)
│   ├── translation.service.ts        # 중복
│   ├── google-translate.service.ts   # 중복
│   ├── product-translation.service.ts
│   ├── section-translation.service.ts
│   └── json-language.service.ts
├── cache/
│   ├── language-packs.ts
│   └── static-language-generator.ts
├── translation.service.ts            # 중복 (lib 루트)
├── google-translate.service.ts       # 중복 (lib 루트)
└── language.ts                       # 레거시
```

### 1.3 기존 구현 상태
- ✅ `language-manager.ts`: 3개 언어 제한 로직 구현됨
- ✅ `languages/settings/route.ts`: 언어 설정 API 구현됨
- ✅ `translate-settings/route.ts`: Google API 설정 구현됨
- ❌ 언어팩과 UI 섹션 연동 미완성
- ❌ 헤더/푸터 언어팩 연동 없음
- ❌ JSON 생성 자동화 미구현

---

## 2. 🔧 Day 1: 백업 및 초기 정리

### 2.1 백업 폴더 생성
```bash
# 백업 디렉토리 생성
mkdir -p backup/2025-09-02/{api,services,components}

# API 백업
cp -r app/api/admin/language-pack-keys backup/2025-09-02/api/
cp -r app/api/admin/translations backup/2025-09-02/api/

# 서비스 백업
cp lib/translation.service.ts backup/2025-09-02/services/
cp lib/google-translate.service.ts backup/2025-09-02/services/
cp lib/language.ts backup/2025-09-02/services/

# 중복 컴포넌트 백업
cp components/admin/ui-config/SectionManagerTab.tsx backup/2025-09-02/components/
cp components/admin/ui-config/SectionOrderTab.tsx backup/2025-09-02/components/
```

### 2.2 통합 폴더 구조 생성
```bash
# 새 API 구조 생성
mkdir -p app/api/admin/i18n/{settings,content,translate}

# 새 서비스 구조 생성
mkdir -p lib/i18n/{core,providers,cache,generators}
```

---

## 3. 📝 Day 2: API 통합

### 3.1 API 매핑 계획
| 기존 API | 신규 API | 작업 |
|---------|----------|------|
| `/languages/settings/*` | `/i18n/settings/*` | 이동 |
| `/language-packs/*` | `/i18n/content/*` | 이동 |
| `/translate-settings/*` | `/i18n/settings/google` | 이동 |
| `/translations/*` | `/i18n/translate/*` | 통합 |
| `/language-pack-keys/*` | 삭제 | content에 통합 |

### 3.2 리디렉션 설정 (하위 호환성)
```typescript
// app/api/admin/language-packs/route.ts
import { NextResponse } from 'next/server'

export async function GET(request: Request) {
  return NextResponse.redirect(
    new URL('/api/admin/i18n/content', request.url)
  )
}
```

---

## 4. 🗄️ Day 3: 데이터베이스 스키마

### 4.1 테이블 생성 SQL
```sql
-- 언어 설정 테이블 (이미 존재하는 경우 스킵)
CREATE TABLE IF NOT EXISTS language_settings (
    code VARCHAR(10) PRIMARY KEY,
    name VARCHAR(100),
    native_name VARCHAR(100),
    google_code VARCHAR(10),
    direction VARCHAR(3) DEFAULT 'ltr',
    flag_emoji VARCHAR(10),
    enabled BOOLEAN DEFAULT false,
    is_default BOOLEAN DEFAULT false,
    display_order INTEGER,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 언어팩 키 테이블 (개선)
CREATE TABLE IF NOT EXISTS language_pack_keys (
    id SERIAL PRIMARY KEY,
    namespace VARCHAR(50) DEFAULT 'common',
    key VARCHAR(255) NOT NULL,
    category VARCHAR(50),
    default_value TEXT, -- 한국어 기본값
    description TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(namespace, key)
);

-- 언어팩 번역 테이블
CREATE TABLE IF NOT EXISTS language_pack_translations (
    id SERIAL PRIMARY KEY,
    key_id INTEGER REFERENCES language_pack_keys(id) ON DELETE CASCADE,
    language_code VARCHAR(10) REFERENCES language_settings(code),
    value TEXT,
    is_auto_translated BOOLEAN DEFAULT false,
    translated_at TIMESTAMP,
    verified_at TIMESTAMP,
    UNIQUE(key_id, language_code)
);

-- 초기 데이터
INSERT INTO language_settings (code, name, native_name, google_code, enabled, is_default, display_order)
VALUES 
    ('ko', '한국어', '한국어', 'ko', true, true, 1)
ON CONFLICT (code) DO NOTHING;
```

---

## 5. 🔌 Day 4: 서비스 레이어 통합

### 5.1 서비스 통합 구조
```typescript
// lib/i18n/index.ts - 통합 엔트리 포인트
export { LanguageManager } from './core/LanguageManager'
export { TranslationEngine } from './core/TranslationEngine'
export { GoogleTranslateProvider } from './providers/GoogleTranslate'
export { JSONGenerator } from './generators/JSONGenerator'
export { CacheManager } from './cache/CacheManager'
```

### 5.2 파일 이동 계획
```bash
# 핵심 파일 이동
mv lib/services/language-manager.ts lib/i18n/core/LanguageManager.ts
mv lib/services/google-translate.service.ts lib/i18n/providers/GoogleTranslate.ts
mv lib/services/json-language.service.ts lib/i18n/generators/JSONGenerator.ts
mv lib/cache/language-packs.ts lib/i18n/cache/CacheManager.ts

# 중복 파일 제거
rm lib/translation.service.ts
rm lib/google-translate.service.ts
rm lib/language.ts
```

---

## 6. 🎨 Day 5: UI 통합

### 6.1 언어 설정 탭 구현
```typescript
// components/admin/language-packs/LanguageSettingsTab.tsx
interface LanguageSettingsTabProps {
  onLanguageChange: (languages: string[]) => void
}

// 주요 기능:
// - 언어 선택 (최대 3개, 한국어 고정)
// - Google Translate API 키 설정
// - 언어별 활성화/비활성화
```

### 6.2 섹션 언어팩 연동
```typescript
// components/admin/ui-config/SectionsConfigTab.tsx 수정
// - 각 섹션에 translations 필드 추가
// - 언어별 입력 폼 제공
// - 자동 번역 버튼 추가
```

---

## 7. ⚡ 즉시 실행 가능한 작업

### 7.1 중복 파일 백업 (30분)
```bash
#!/bin/bash
# backup-duplicates.sh

BACKUP_DIR="backup/2025-09-02"
mkdir -p $BACKUP_DIR/{api,services,components}

# API 백업
echo "Backing up duplicate APIs..."
cp -r app/api/admin/language-pack-keys $BACKUP_DIR/api/
cp -r app/api/admin/translations $BACKUP_DIR/api/

# 서비스 백업
echo "Backing up duplicate services..."
cp lib/translation.service.ts $BACKUP_DIR/services/ 2>/dev/null || true
cp lib/google-translate.service.ts $BACKUP_DIR/services/ 2>/dev/null || true

# 컴포넌트 백업
echo "Backing up duplicate components..."
cp components/admin/ui-config/SectionManagerTab.tsx $BACKUP_DIR/components/ 2>/dev/null || true
cp components/admin/ui-config/SectionOrderTab.tsx $BACKUP_DIR/components/ 2>/dev/null || true

echo "Backup completed at $BACKUP_DIR"
```

### 7.2 새 구조 생성 (10분)
```bash
#!/bin/bash
# create-new-structure.sh

echo "Creating new i18n structure..."
mkdir -p app/api/admin/i18n/{settings,content,translate}
mkdir -p lib/i18n/{core,providers,cache,generators}
mkdir -p contexts/i18n/hooks

echo "New structure created successfully"
```

---

## 8. 📋 체크리스트

### 백업 작업 ✅
- [ ] 중복 API 백업
- [ ] 중복 서비스 백업
- [ ] 중복 컴포넌트 백업
- [ ] 데이터베이스 백업

### 구조 정리 🔄
- [ ] 새 폴더 구조 생성
- [ ] API 통합 (5개 → 3개)
- [ ] 서비스 통합 (12개 → 7개)
- [ ] 컴포넌트 정리 (3개 → 1개)

### 기능 구현 📦
- [ ] 언어 설정 탭
- [ ] 헤더/푸터 언어팩 연동
- [ ] 섹션 언어팩 연동
- [ ] JSON 자동 생성
- [ ] 캐싱 시스템

### 테스트 🧪
- [ ] API 리디렉션 테스트
- [ ] 언어 전환 테스트
- [ ] JSON 생성 테스트
- [ ] 성능 테스트

---

## 9. 🚨 주의사항

### 절대 하지 말아야 할 것
- ❌ 백업 폴더 삭제
- ❌ 기존 API 즉시 삭제 (리디렉션 설정 후)
- ❌ 한국어 기본 설정 변경
- ❌ 3개 언어 제한 해제

### 반드시 확인할 것
- ✅ 모든 변경 전 백업
- ✅ API 하위 호환성 유지
- ✅ 컴포넌트 import 경로 수정
- ✅ 테스트 후 배포

---

## 10. 📈 예상 효과

### 정량적 개선
- API 디렉토리: 5개 → 3개 (40% 감소)
- 서비스 파일: 12개 → 7개 (42% 감소)
- 중복 코드: 63개 → 0개 (100% 제거)
- 응답 속도: 50% 향상 예상

### 정성적 개선
- 명확한 폴더 구조
- 일관된 네이밍
- 쉬운 유지보수
- 빠른 언어 추가

---

## 🎯 최종 목표

**관리자가 언어팩에서 언어를 선택하면, 모든 UI 요소(헤더/푸터/섹션)가 자동으로 다국어 JSON을 생성하여 메인페이지에서 빠르게 렌더링되는 통합 시스템 구축**

이 계획을 단계별로 실행하면 5일 내에 완성 가능합니다.
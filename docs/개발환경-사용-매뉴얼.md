# í•˜ì´ë¸Œë¦¬ë“œ ê°œë°œí™˜ê²½ ì‚¬ìš© ë§¤ë‰´ì–¼

## ğŸ“‹ ëª©ì°¨
1. [ì¼ìƒ ê°œë°œ ì›Œí¬í”Œë¡œìš°](#ì¼ìƒ-ê°œë°œ-ì›Œí¬í”Œë¡œìš°)
2. [í•„ìˆ˜ ëª…ë ¹ì–´ ëª¨ìŒ](#í•„ìˆ˜-ëª…ë ¹ì–´-ëª¨ìŒ)
3. [ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬](#ë°ì´í„°ë² ì´ìŠ¤-ê´€ë¦¬)
4. [ë¹Œë“œ ë° ë°°í¬](#ë¹Œë“œ-ë°-ë°°í¬)
5. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)
6. [ìœ ì§€ë³´ìˆ˜](#ìœ ì§€ë³´ìˆ˜)

---

## ğŸš€ ì¼ìƒ ê°œë°œ ì›Œí¬í”Œë¡œìš°

### 1. **í”„ë¡œì íŠ¸ ì‹œì‘**
```bash
# í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ì´ë™
cd /Users/admin/new_project/commerce-nextjs

# í™˜ê²½ë³€ìˆ˜ í™•ì¸
cat .env | grep -E "(DATABASE_URL|REDIS_URL)"

# ì„œë²„ ì—°ê²° ìƒíƒœ í™•ì¸
npm run test:server
```

### 2. **ë¡œì»¬ ê°œë°œ ì‹œì‘**
```bash
# ê°œë°œ ì„œë²„ ì‹¤í–‰
npm run dev

# ë˜ëŠ” Vercel CLIë¡œ ì‹¤í–‰ (ê¶Œì¥)
vercel dev
```

### 3. **ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ**
```bash
# 1. Drizzle ìŠ¤í‚¤ë§ˆ íŒŒì¼ ìˆ˜ì •
# drizzle/migrations/schema.ts

# 2. ë³€ê²½ì‚¬í•­ì„ SQLë¡œ ìƒì„±
npx drizzle-kit generate

# 3. ì„œë²„ì— ìŠ¤í‚¤ë§ˆ ì ìš©
npm run sync:schema
```

### 4. **ë°°í¬ ì „ ê²€ì¦**
```bash
# ë¹Œë“œ ì—ëŸ¬ ì²´í¬
npm run build:check

# Vercel í™˜ê²½ í…ŒìŠ¤íŠ¸ (ë°°í¬ ì—†ìŒ)
vercel build --prod

# íƒ€ì… ê²€ì¦
npm run typecheck
```

---

## ğŸ› ï¸ í•„ìˆ˜ ëª…ë ¹ì–´ ëª¨ìŒ

### **npm ìŠ¤í¬ë¦½íŠ¸ (package.json)**

#### ê°œë°œ ê´€ë ¨
```bash
npm run dev              # ë¡œì»¬ ê°œë°œ ì„œë²„ ì‹œì‘
npm run build           # í”„ë¡œë•ì…˜ ë¹Œë“œ
npm run start           # í”„ë¡œë•ì…˜ ì„œë²„ ì‹œì‘
npm run typecheck       # TypeScript íƒ€ì… ê²€ì¦
npm run lint           # ESLint ê²€ì‚¬
```

#### ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨
```bash
npm run test:server     # ì„œë²„ DB ì—°ê²° í…ŒìŠ¤íŠ¸
npm run test:drizzle    # Drizzle ORM í…ŒìŠ¤íŠ¸
npm run sync:schema     # ìŠ¤í‚¤ë§ˆ ì„œë²„ ë™ê¸°í™”
npm run migrate:server  # ì„œë²„ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
```

#### ë¹Œë“œ ê²€ì¦ ê´€ë ¨
```bash
npm run build:check     # ìƒì„¸ ë¹Œë“œ ê²€ì¦
npm run build:analyze   # ë²ˆë“¤ ë¶„ì„
npm run vercel:test     # Vercel ë¡œì»¬ í…ŒìŠ¤íŠ¸
```

### **Drizzle ëª…ë ¹ì–´**
```bash
# ìŠ¤í‚¤ë§ˆ ìƒì„±/ì—…ë°ì´íŠ¸
npx drizzle-kit generate

# ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸
npx drizzle-kit introspect

# ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
npx drizzle-kit push
```

### **Vercel CLI ëª…ë ¹ì–´**
```bash
# ë¡œì»¬ ê°œë°œ (Vercel í™˜ê²½)
vercel dev

# ë¹Œë“œë§Œ ì‹¤í–‰ (ë°°í¬ ì—†ìŒ)
vercel build --prod

# í™˜ê²½ë³€ìˆ˜ í™•ì¸
vercel env ls

# í”„ë¡œì íŠ¸ ì •ë³´
vercel project ls
```

### **ì„œë²„ ê´€ë¦¬ ëª…ë ¹ì–´**
```bash
# ì„œë²„ SSH ì ‘ì†
ssh root@141.164.60.51

# ì„œë²„ ìƒíƒœ í™•ì¸
ssh root@141.164.60.51 'podman ps -a'

# ìŠ¤í† ë¦¬ì§€ ìš©ëŸ‰ í™•ì¸
ssh root@141.164.60.51 'df -h /mnt/blockstorage'

# ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ
ssh root@141.164.60.51 'PGPASSWORD=ITeRgI4nxSZCaefOaheYJLnA5 psql -U nextjs_user -d nextjs_production -c "SELECT count(*) FROM users;"'
```

---

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬

### **ì—°ê²° ìƒíƒœ í™•ì¸**
```bash
# ì „ì²´ ì—°ê²° í…ŒìŠ¤íŠ¸
npx tsx scripts/test-server-connection.ts

# Drizzle ì—°ê²°ë§Œ í…ŒìŠ¤íŠ¸
npx tsx scripts/test-drizzle-connection.ts

# ê¸°ë³¸ DB ì—°ê²° í…ŒìŠ¤íŠ¸
npm run test:server
```

### **ìŠ¤í‚¤ë§ˆ ê´€ë¦¬ ì›Œí¬í”Œë¡œìš°**

#### 1. ìƒˆ í…Œì´ë¸” ì¶”ê°€
```typescript
// drizzle/migrations/schema.tsì— ì¶”ê°€
export const newTable = pgTable('new_table', {
  id: uuid('id').defaultRandom().primaryKey(),
  name: varchar('name', { length: 255 }).notNull(),
  created_at: timestamp('created_at').defaultNow(),
});
```

#### 2. ì„œë²„ì— ì ìš©
```bash
# SQL ìƒì„±
npx drizzle-kit generate

# ì„œë²„ì— ìˆ˜ë™ ì ìš©
ssh root@141.164.60.51 'PGPASSWORD=ITeRgI4nxSZCaefOaheYJLnA5 psql -U nextjs_user -d nextjs_production -c "CREATE TABLE new_table(...);"'
```

### **ë°ì´í„° ë°±ì—…/ë³µì›**
```bash
# ì„œë²„ ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
ssh root@141.164.60.51 'PGPASSWORD=ITeRgI4nxSZCaefOaheYJLnA5 pg_dump -U nextjs_user nextjs_production > backup_$(date +%Y%m%d).sql'

# ë°±ì—… ë‹¤ìš´ë¡œë“œ
scp root@141.164.60.51:~/backup_*.sql ./backups/

# í…Œì´ë¸”ë³„ ë°ì´í„° í™•ì¸
ssh root@141.164.60.51 'PGPASSWORD=ITeRgI4nxSZCaefOaheYJLnA5 psql -U nextjs_user -d nextjs_production -c "\dt"'
```

---

## ğŸš¢ ë¹Œë“œ ë° ë°°í¬

### **ë¡œì»¬ ë¹Œë“œ ê²€ì¦ (í•„ìˆ˜)**

#### Vercel CLI ì‚¬ìš© (ê¶Œì¥)
```bash
# 1. ê°œë°œ í™˜ê²½ í…ŒìŠ¤íŠ¸
vercel dev

# 2. í”„ë¡œë•ì…˜ ë¹Œë“œ í…ŒìŠ¤íŠ¸ (ë°°í¬ ì•ˆí•¨)
vercel build --prod

# 3. í™˜ê²½ë³€ìˆ˜ í™•ì¸
vercel env ls
```

#### Next.js ì§ì ‘ ë¹Œë“œ
```bash
# 1. íƒ€ì… ê²€ì¦
npm run typecheck

# 2. ë¦°íŠ¸ ê²€ì‚¬
npm run lint

# 3. ë¹Œë“œ ì‹¤í–‰
npm run build

# 4. ìƒì„¸ ë¹Œë“œ ì²´í¬
npm run build:check

# 5. ë²ˆë“¤ ë¶„ì„ (ì˜µì…˜)
npm run build:analyze
```

### **ì„œë²„ ë°°í¬ ì¤€ë¹„**

#### 1. ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ë¡œì»¬ ë¹Œë“œ ì„±ê³µ
- [ ] ì„œë²„ DB ì—°ê²° í™•ì¸
- [ ] í™˜ê²½ë³€ìˆ˜ ì„¤ì • í™•ì¸
- [ ] ìŠ¤í‚¤ë§ˆ ë™ê¸°í™” ì™„ë£Œ

#### 2. ì„œë²„ ë°°í¬ (ì˜ˆì •)
```bash
# Gitì„ í†µí•œ ë°°í¬
git add .
git commit -m "feat: ìƒˆ ê¸°ëŠ¥ ì¶”ê°€"
git push origin main

# ì„œë²„ì—ì„œ ë¹Œë“œ ë° ë°°í¬ (êµ¬í˜„ ì˜ˆì •)
ssh root@141.164.60.51 './deploy-commerce.sh'
```

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### **ì—°ê²° ë¬¸ì œ**

#### ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨
```bash
# 1. í™˜ê²½ë³€ìˆ˜ í™•ì¸
echo $DATABASE_URL

# 2. ì„œë²„ ìƒíƒœ í™•ì¸
ssh root@141.164.60.51 'podman ps | grep postgres'

# 3. í¬íŠ¸ í™•ì¸
ssh root@141.164.60.51 'netstat -tlnp | grep 5432'

# 4. ì—°ê²° í…ŒìŠ¤íŠ¸
npm run test:server
```

#### Redis ì—°ê²° ë¬¸ì œ
```bash
# Redis ì»¨í…Œì´ë„ˆ ìƒíƒœ
ssh root@141.164.60.51 'podman ps | grep redis'

# Redis ì—°ê²° í…ŒìŠ¤íŠ¸
ssh root@141.164.60.51 'redis-cli -h localhost -p 6379 -a hFAqbBwwLkzOMO4QEsGsw5Jck ping'
```

### **ë¹Œë“œ ë¬¸ì œ**

#### íƒ€ì… ì—ëŸ¬
```bash
# íƒ€ì… ê²€ì¦ ì‹¤í–‰
npm run typecheck

# Drizzle ìŠ¤í‚¤ë§ˆ ì¬ìƒì„±
npx drizzle-kit generate
```

#### ì¢…ì†ì„± ë¬¸ì œ
```bash
# node_modules ì¬ì„¤ì¹˜
rm -rf node_modules package-lock.json
npm install

# ìºì‹œ ì •ë¦¬
npm run build -- --no-cache
```

### **ìŠ¤í‚¤ë§ˆ ë™ê¸°í™” ë¬¸ì œ**

#### ë¡œì»¬ê³¼ ì„œë²„ ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜
```bash
# 1. ì„œë²„ ìŠ¤í‚¤ë§ˆ í™•ì¸
ssh root@141.164.60.51 'PGPASSWORD=ITeRgI4nxSZCaefOaheYJLnA5 psql -U nextjs_user -d nextjs_production -c "\d users"'

# 2. ë¡œì»¬ ìŠ¤í‚¤ë§ˆì™€ ë¹„êµ
npx drizzle-kit introspect

# 3. ìˆ˜ë™ ìŠ¤í‚¤ë§ˆ ë™ê¸°í™”
npm run sync:schema
```

---

## ğŸ”„ ìœ ì§€ë³´ìˆ˜

### **ì •ê¸° ì ê²€ (ì£¼ 1íšŒ)**

#### ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
```bash
# 1. ì„œë²„ ì—°ê²° ìƒíƒœ
npm run test:server

# 2. ìŠ¤í† ë¦¬ì§€ ìš©ëŸ‰
ssh root@141.164.60.51 'df -h /mnt/blockstorage'

# 3. ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ
ssh root@141.164.60.51 'PGPASSWORD=ITeRgI4nxSZCaefOaheYJLnA5 psql -U nextjs_user -d nextjs_production -c "SELECT pg_size_pretty(pg_database_size('\''nextjs_production'\''));"'

# 4. ì»¨í…Œì´ë„ˆ ìƒíƒœ
ssh root@141.164.60.51 'podman stats --no-stream'
```

#### ë¡œê·¸ í™•ì¸
```bash
# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸
tail -f logs/app.log

# ì„œë²„ ì‹œìŠ¤í…œ ë¡œê·¸
ssh root@141.164.60.51 'journalctl -f -u podman'
```

### **ë°±ì—… (ì£¼ 1íšŒ)**
```bash
# 1. ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
./scripts/backup-database.sh

# 2. ìŠ¤í† ë¦¬ì§€ ë°±ì—…
rsync -av root@141.164.60.51:/mnt/blockstorage/projects/commerce/ ./backups/storage/

# 3. ì„¤ì • íŒŒì¼ ë°±ì—…
cp .env ./backups/config/env_$(date +%Y%m%d)
```

### **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**
```bash
# 1. ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥
ssh root@141.164.60.51 'PGPASSWORD=ITeRgI4nxSZCaefOaheYJLnA5 psql -U nextjs_user -d nextjs_production -c "SELECT * FROM pg_stat_activity;"'

# 2. Redis ì„±ëŠ¥
ssh root@141.164.60.51 'redis-cli -p 6379 -a hFAqbBwwLkzOMO4QEsGsw5Jck info stats'

# 3. ìŠ¤í† ë¦¬ì§€ I/O
ssh root@141.164.60.51 'iostat -x 1 3'
```

---

## ğŸ“ ê¸´ê¸‰ ìƒí™© ëŒ€ì‘

### **ì„œë²„ ë‹¤ìš´ ì‹œ**
1. **ì„œë²„ ìƒíƒœ í™•ì¸**: `ssh root@141.164.60.51`
2. **ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘**: `podman restart postgres_container redis_container`
3. **ë¡œê·¸ í™•ì¸**: `journalctl -xe`
4. **ë³µêµ¬ í›„ ì—°ê²° í…ŒìŠ¤íŠ¸**: `npm run test:server`

### **ë°ì´í„° ì†ì‹¤ ì‹œ**
1. **ì¦‰ì‹œ ë°±ì—… ì¤‘ë‹¨**
2. **ìµœì‹  ë°±ì—… íŒŒì¼ í™•ì¸**: `ls -la backups/`
3. **ë³µì› ì‹¤í–‰**: `./scripts/restore-database.sh backup_file.sql`
4. **ë°ì´í„° ì •í•©ì„± í™•ì¸**: `npm run test:data-integrity`

### **ë¹Œë“œ ì‹¤íŒ¨ ì‹œ**
1. **ì—ëŸ¬ ë¡œê·¸ í™•ì¸**: `npm run build 2>&1 | tee build-error.log`
2. **ì˜ì¡´ì„± ì¬ì„¤ì¹˜**: `rm -rf node_modules && npm install`
3. **Vercel ë¡œì»¬ í…ŒìŠ¤íŠ¸**: `vercel build --prod`
4. **ë‹¨ê³„ë³„ ë¹Œë“œ**: `npm run typecheck && npm run lint && npm run build`

---

## ğŸ“š ì¶”ê°€ ë¦¬ì†ŒìŠ¤

### **ê´€ë ¨ ë¬¸ì„œ**
- [í•˜ì´ë¸Œë¦¬ë“œ ê°œë°œí™˜ê²½ êµ¬ì¶• ê°€ì´ë“œ](./í•˜ì´ë¸Œë¦¬ë“œ-ê°œë°œí™˜ê²½-êµ¬ì¶•-ê°€ì´ë“œ.md)
- [í”„ë¡œì íŠ¸ ê´€ë¦¬ ë¬¸ì„œ](./í”„ë¡œì íŠ¸ê´€ë¦¬.md)

### **ìœ ìš©í•œ ë„êµ¬**
- **Drizzle Studio**: `npx drizzle-kit studio`
- **PostgreSQL í´ë¼ì´ì–¸íŠ¸**: TablePlus, pgAdmin
- **Redis í´ë¼ì´ì–¸íŠ¸**: RedisInsight
- **ì„œë²„ ëª¨ë‹ˆí„°ë§**: htop, iotop

### **ë„ì›€ë§**
- **Drizzle ORM**: https://orm.drizzle.team/
- **Vercel CLI**: https://vercel.com/docs/cli
- **Next.js**: https://nextjs.org/docs

---

*ìµœì¢… ì—…ë°ì´íŠ¸: 2025ë…„ 9ì›” 4ì¼*  
*í™˜ê²½: í•˜ì´ë¸Œë¦¬ë“œ ê°œë°œí™˜ê²½ (ë¡œì»¬ + ì„œë²„ 141.164.60.51)*
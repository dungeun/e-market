# 🗺️ 언어팩 설정 기반 통합 시스템 구현 로드맵

## 📅 작성일: 2025-09-02
## 🎯 목적: 관리자 선택형 다국어 시스템 구현 상세 로드맵

---

## 1. 🔍 현재 시스템 분석 결과

### 1.1 기존 구조 현황

#### 데이터베이스 구조
```sql
-- 현재 language_packs 테이블 (단순 구조)
CREATE TABLE language_packs (
    id VARCHAR(25) PRIMARY KEY,
    language_code VARCHAR(10) NOT NULL,    -- ko, en, ja 고정
    namespace VARCHAR(50) DEFAULT 'common',
    key VARCHAR(255) NOT NULL,
    value TEXT NOT NULL,
    category VARCHAR(50) DEFAULT 'ui',
    UNIQUE(language_code, namespace, key)
);

-- system_settings 테이블 (API 키 저장용)
CREATE TABLE system_settings (
    key VARCHAR(255) UNIQUE NOT NULL,
    value TEXT,
    description TEXT
);
```

#### 주요 파일 현황
- `/app/admin/language-packs/page.tsx` - 3개 언어 하드코딩 (ko, en, ja)
- `/app/api/admin/translate-settings/route.ts` - Google API 설정만 지원
- `/app/api/admin/languages/settings/route.ts` - 언어 설정 관리 API
- `/lib/services/language-manager.ts` - 언어 관리 서비스

### 1.2 문제점 및 개선 필요사항

1. **고정된 언어 시스템**
   - ko, en, ja 하드코딩으로 인한 유연성 부재
   - 새 언어 추가 시 전체 코드 수정 필요

2. **설정 탭 부재**
   - 언어 선택 UI 없음
   - API 제공업체 선택 기능 없음
   - 사용량 모니터링 없음

3. **동적 스키마 미지원**
   - 언어별 컬럼 동적 생성 불가
   - 번역 테이블 분리 필요

---

## 2. 📋 구현 로드맵

### Phase 1: 데이터베이스 스키마 확장 (Day 1)

#### 1.1 언어 설정 테이블 생성
```sql
-- 언어 설정 마스터 테이블
CREATE TABLE IF NOT EXISTS language_settings (
    id SERIAL PRIMARY KEY,
    code VARCHAR(10) UNIQUE NOT NULL,      -- ko, en, zh-CN, etc
    name VARCHAR(100) NOT NULL,            -- English, 한국어, 中文
    native_name VARCHAR(100),              -- Native language name
    google_code VARCHAR(10),               -- Google Translate API code
    direction VARCHAR(3) DEFAULT 'ltr',    -- ltr or rtl
    flag_emoji VARCHAR(10),                -- 🇰🇷 🇺🇸 🇯🇵
    enabled BOOLEAN DEFAULT false,         -- 활성화 상태
    is_default BOOLEAN DEFAULT false,      -- 기본 언어 (한국어)
    display_order INTEGER DEFAULT 999,     -- 표시 순서
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 초기 데이터 삽입
INSERT INTO language_settings (code, name, native_name, google_code, flag_emoji, enabled, is_default, display_order) VALUES
('ko', 'Korean', '한국어', 'ko', '🇰🇷', true, true, 1),
('en', 'English', 'English', 'en', '🇺🇸', false, false, 2),
('ja', 'Japanese', '日本語', 'ja', '🇯🇵', false, false, 3),
('zh-CN', 'Chinese (Simplified)', '简体中文', 'zh-CN', '🇨🇳', false, false, 4),
('zh-TW', 'Chinese (Traditional)', '繁體中文', 'zh-TW', '🇹🇼', false, false, 5),
-- 추가 언어들...
ON CONFLICT (code) DO NOTHING;
```

#### 1.2 언어팩 번역 테이블 재구성
```sql
-- 언어팩 메타데이터
CREATE TABLE IF NOT EXISTS language_pack_keys (
    id SERIAL PRIMARY KEY,
    namespace VARCHAR(50) DEFAULT 'common',
    key VARCHAR(255) NOT NULL,
    category VARCHAR(50) DEFAULT 'ui',
    description TEXT,
    default_value TEXT NOT NULL,  -- 한국어 기본값
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(namespace, key)
);

-- 언어별 번역 저장
CREATE TABLE IF NOT EXISTS language_pack_translations (
    id SERIAL PRIMARY KEY,
    key_id INTEGER REFERENCES language_pack_keys(id) ON DELETE CASCADE,
    language_code VARCHAR(10) REFERENCES language_settings(code),
    value TEXT NOT NULL,
    is_auto_translated BOOLEAN DEFAULT false,
    translator_id VARCHAR(25),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(key_id, language_code)
);

-- 인덱스 생성
CREATE INDEX idx_lang_pack_trans_lang ON language_pack_translations(language_code);
CREATE INDEX idx_lang_pack_trans_key ON language_pack_translations(key_id);
```

#### 1.3 API 설정 테이블 확장
```sql
-- API 제공업체 설정
CREATE TABLE IF NOT EXISTS translation_api_settings (
    id SERIAL PRIMARY KEY,
    provider VARCHAR(50) NOT NULL,         -- google, deepl, papago, manual
    api_key TEXT,                         -- 암호화된 API 키
    is_active BOOLEAN DEFAULT false,
    monthly_limit INTEGER,                 -- 월간 문자 제한
    monthly_usage INTEGER DEFAULT 0,       -- 현재 사용량
    reset_date DATE,                       -- 사용량 리셋 날짜
    settings JSONB DEFAULT '{}',          -- 추가 설정
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### Phase 2: 관리자 UI 구현 (Day 2-3)

#### 2.1 언어 설정 탭 (`/admin/language-packs?tab=settings`)

**컴포넌트 구조:**
```tsx
// components/admin/language-packs/LanguageSettingsTab.tsx
- LanguageSelector        // 언어 활성화/비활성화
- APIProviderConfig      // API 제공업체 설정
- UsageMonitor          // 사용량 모니터링
- LanguageOrderManager  // 언어 표시 순서 관리
```

**주요 기능:**
1. 언어 활성화 (최대 5개, 한국어 제외)
2. Google Translate API 설정
3. 월간 사용량 모니터링
4. 언어 표시 순서 드래그앤드롭

#### 2.2 UI 수정사항

```tsx
// app/admin/language-packs/page.tsx 수정
interface LanguageSettings {
  enabled_languages: string[];      // ['ko', 'en', 'zh-CN']
  default_language: string;         // 'ko' 고정
  api_provider: 'google' | 'manual';
  api_settings: {
    google_api_key?: string;
    monthly_limit?: number;
    auto_translate: boolean;
  };
}

// 동적 언어 탭 생성
const renderLanguageTabs = () => {
  return enabledLanguages.map(lang => (
    <Tab key={lang.code} value={lang.code}>
      <span>{lang.flag_emoji}</span>
      <span>{lang.native_name}</span>
    </Tab>
  ));
};
```

### Phase 3: API 엔드포인트 구현 (Day 2-3)

#### 3.1 언어 설정 API (`/api/admin/languages/config`)
```typescript
// POST: 언어 활성화/비활성화
{
  action: 'enable' | 'disable',
  language_code: 'en',
  display_order?: 2
}

// GET: 활성 언어 목록
Response: {
  default: 'ko',
  enabled: ['ko', 'en', 'zh-CN'],
  available: [...], // 모든 지원 가능 언어
  settings: {...}
}
```

#### 3.2 동적 번역 API (`/api/admin/translations/dynamic`)
```typescript
// POST: 키 번역 요청
{
  key: 'homepage.title',
  source_language: 'ko',
  target_languages: ['en', 'zh-CN'],
  source_text: '환영합니다',
  provider: 'google' | 'manual'
}

// Response:
{
  translations: {
    en: 'Welcome',
    'zh-CN': '欢迎'
  },
  usage: {
    characters: 12,
    monthly_remaining: 999988
  }
}
```

### Phase 4: 마이그레이션 전략 (Day 4)

#### 4.1 기존 데이터 마이그레이션
```sql
-- 기존 language_packs 데이터를 새 구조로 이전
INSERT INTO language_pack_keys (namespace, key, category, default_value)
SELECT DISTINCT namespace, key, category, ko
FROM language_packs
WHERE language_code = 'ko';

-- 번역 데이터 이전
INSERT INTO language_pack_translations (key_id, language_code, value)
SELECT k.id, 'en', l.en
FROM language_pack_keys k
JOIN language_packs l ON k.key = l.key AND k.namespace = l.namespace
WHERE l.en IS NOT NULL;
```

#### 4.2 하위 호환성 유지
```typescript
// lib/services/language-compatibility.ts
export class LanguageCompatibilityLayer {
  // 기존 API 래퍼
  async getLanguagePack(lang: string) {
    if (['ko', 'en', 'ja'].includes(lang)) {
      // 레거시 지원
      return this.getLegacyFormat(lang);
    }
    // 새 형식
    return this.getDynamicFormat(lang);
  }
}
```

### Phase 5: 캐싱 및 최적화 (Day 5)

#### 5.1 동적 JSON 생성
```typescript
// lib/services/json-generator.ts
export class DynamicJSONGenerator {
  async generateLanguageFiles() {
    const enabledLanguages = await getEnabledLanguages();
    
    for (const lang of enabledLanguages) {
      const translations = await getTranslationsForLanguage(lang.code);
      
      // 카테고리별 JSON 생성
      await this.generateJSON('header', lang.code, translations.header);
      await this.generateJSON('footer', lang.code, translations.footer);
      await this.generateJSON('sections', lang.code, translations.sections);
    }
  }
}
```

#### 5.2 캐싱 전략
```typescript
// 메모리 캐시 (1차)
const memoryCache = new Map<string, CachedTranslation>();

// Redis 캐시 (2차)
const redisCache = createRedisClient();

// 파일 캐시 (3차)
const fileCache = '/public/i18n/cache/';

// 캐시 무효화
socket.on('language:changed', async (data) => {
  await invalidateCache(data.language_code);
  await regenerateJSON(data.language_code);
});
```

---

## 3. 🚀 구현 우선순위

### 즉시 실행 (Day 1)
- [x] 데이터베이스 스키마 생성
- [ ] language_settings 테이블 초기 데이터 입력
- [ ] 기존 데이터 백업

### 단기 실행 (Day 2-3)
- [ ] 언어 설정 탭 UI 구현
- [ ] API 엔드포인트 개발
- [ ] Google Translate 통합

### 중기 실행 (Day 4-5)
- [ ] 데이터 마이그레이션
- [ ] 캐싱 시스템 구현
- [ ] 실시간 동기화

### 장기 실행 (Week 2)
- [ ] 성능 최적화
- [ ] 모니터링 대시보드
- [ ] 백업/복구 시스템

---

## 4. ✅ 구현 체크리스트

### 데이터베이스
- [ ] language_settings 테이블 생성
- [ ] language_pack_keys 테이블 생성
- [ ] language_pack_translations 테이블 생성
- [ ] translation_api_settings 테이블 생성
- [ ] 인덱스 및 제약조건 설정
- [ ] 초기 데이터 삽입

### API 개발
- [ ] `/api/admin/languages/config` - 언어 설정 관리
- [ ] `/api/admin/translations/dynamic` - 동적 번역
- [ ] `/api/admin/translations/batch` - 일괄 번역
- [ ] `/api/admin/languages/usage` - 사용량 조회

### UI 컴포넌트
- [ ] LanguageSettingsTab 컴포넌트
- [ ] LanguageSelector 컴포넌트
- [ ] APIProviderConfig 컴포넌트
- [ ] UsageMonitor 컴포넌트
- [ ] DynamicLanguageTabs 컴포넌트

### 서비스 레이어
- [ ] LanguageManager 확장
- [ ] TranslationService 구현
- [ ] CacheManager 구현
- [ ] JSONGenerator 구현

### 테스트
- [ ] 단위 테스트
- [ ] 통합 테스트
- [ ] E2E 테스트
- [ ] 성능 테스트

---

## 5. 🔄 마이그레이션 단계

### Step 1: 준비
```bash
# 데이터베이스 백업
pg_dump -h localhost -p 5434 -U postgres commerce_nextjs > backup_$(date +%Y%m%d).sql

# 테스트 환경 구성
cp .env .env.backup
```

### Step 2: 스키마 적용
```sql
-- 새 테이블 생성 (위 스키마 참조)
-- 기존 데이터 마이그레이션
-- 인덱스 재구성
```

### Step 3: 코드 배포
```bash
# 새 코드 배포
git checkout -b feature/dynamic-language-system
npm run build
npm run test
```

### Step 4: 검증
```typescript
// 체크리스트
- [ ] 기존 3개 언어 정상 작동
- [ ] 새 언어 추가 가능
- [ ] 번역 자동화 작동
- [ ] 캐시 시스템 정상
- [ ] 실시간 동기화 확인
```

---

## 6. 🎯 예상 결과

### 기능적 개선
- **유연성**: 관리자가 원하는 언어 자유롭게 추가/제거
- **확장성**: 새 번역 API 쉽게 통합
- **효율성**: 사용하는 언어만 로드하여 성능 최적화

### 기술적 개선
- **동적 스키마**: 언어 추가 시 자동 컬럼 생성
- **캐싱 최적화**: 3단계 캐싱으로 응답 속도 개선
- **모니터링**: API 사용량 실시간 추적

### 비즈니스 가치
- **비용 절감**: 필요한 언어만 활성화
- **시장 확장**: 새로운 지역 진출 용이
- **관리 효율**: 중앙화된 언어 관리

---

## 7. ⚠️ 위험 요소 및 대응

### 위험 1: 데이터 마이그레이션 실패
- **대응**: 롤백 스크립트 준비, 단계별 검증

### 위험 2: API 비용 초과
- **대응**: 사용량 제한, 알림 시스템

### 위험 3: 성능 저하
- **대응**: 캐싱 강화, 쿼리 최적화

### 위험 4: 하위 호환성 문제
- **대응**: 호환성 레이어 유지, 점진적 마이그레이션

---

## 8. 📊 성공 지표

### 기술 지표
- API 응답 시간 < 200ms
- 캐시 히트율 > 90%
- 번역 정확도 > 95%

### 비즈니스 지표
- 언어 추가 시간: 3시간 → 10분
- 번역 비용: 50% 절감
- 신규 시장 진출: 3개월 → 1주일

### 사용자 지표
- 관리자 만족도 향상
- 언어 전환 속도 개선
- 번역 품질 일관성 유지

---

## 9. 🔗 참고 자료

### 기술 문서
- [Google Translate API](https://cloud.google.com/translate/docs)
- [PostgreSQL JSONB](https://www.postgresql.org/docs/current/datatype-json.html)
- [Next.js i18n](https://nextjs.org/docs/app/building-your-application/routing/internationalization)

### 내부 문서
- `/언어팩-설정-기반-통합-시스템-설계서.md`
- `/전체-시스템-Google-API-통합-설계서.md`
- `/통합-언어팩-시스템-전체설계서.md`

---

## 10. 💡 결론

현재 고정된 3개 언어 시스템을 동적 다국어 시스템으로 전환하는 것은 기술적으로 충분히 실현 가능하며, 비즈니스 가치가 높은 개선사항입니다.

**핵심 성공 요소:**
1. 데이터베이스 스키마의 유연한 설계
2. 관리자 친화적인 UI/UX
3. 강력한 캐싱 및 성능 최적화
4. 단계별 마이그레이션 전략

이 로드맵을 따라 구현하면 **5일 내**에 MVP를 완성하고, **2주 내**에 완전한 시스템을 구축할 수 있습니다.
# í•˜ì´ë¸Œë¦¬ë“œ ê°œë°œí™˜ê²½ êµ¬ì¶• ì™„ë£Œ ê°€ì´ë“œ

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

**ë¡œì»¬ ê°œë°œ + ì„œë²„ ë¦¬ì†ŒìŠ¤** í•˜ì´ë¸Œë¦¬ë“œ ì•„í‚¤í…ì²˜ë¡œ Supabaseì™€ ìœ ì‚¬í•œ ê°œë°œ í™˜ê²½ êµ¬ì¶•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ë¡œì»¬ ê°œë°œí™˜ê²½    â”‚â”€â”€â”€â”€â”‚      ì„œë²„ (141.164.60.51)       â”‚
â”‚                â”‚    â”‚                                â”‚
â”‚ â€¢ Next.js ì½”ë”©  â”‚    â”‚ â€¢ PostgreSQL (nextjs_production)â”‚
â”‚ â€¢ Drizzle ìŠ¤í‚¤ë§ˆ â”‚â—„â”€â”€â”€â”‚ â€¢ Redis (ì¸ì¦)                  â”‚
â”‚ â€¢ Vercel CLI    â”‚    â”‚ â€¢ ë¸”ë¡ ìŠ¤í† ë¦¬ì§€ (98GB)           â”‚
â”‚ â€¢ ê°œë°œì„œë²„ë§Œ     â”‚    â”‚ â€¢ Podman ì»¨í…Œì´ë„ˆ ê´€ë¦¬           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ PowerDNS ê´€ë¦¬                 â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ ì„œë²„ ì•„í‚¤í…ì²˜

### ë©€í‹°í…Œë„ŒíŠ¸ PaaS êµ¬ì¡°
```
ì„œë²„ (141.164.60.51)
â”œâ”€ Podman ì»¨í…Œì´ë„ˆ ê´€ë¦¬
â”‚  â”œâ”€ í”„ë¡œì íŠ¸A/
â”‚  â”‚  â”œâ”€ PostgreSQL ì»¨í…Œì´ë„ˆ (í¬íŠ¸: 5433)
â”‚  â”‚  â”œâ”€ Redis ì»¨í…Œì´ë„ˆ (í¬íŠ¸: 6380)
â”‚  â”‚  â””â”€ ìŠ¤í† ë¦¬ì§€ ë³¼ë¥¨
â”‚  â”‚
â”‚  â”œâ”€ commerce-nextjs/ (í˜„ì¬ í”„ë¡œì íŠ¸)
â”‚  â”‚  â”œâ”€ PostgreSQL ì»¨í…Œì´ë„ˆ (í¬íŠ¸: 5432)
â”‚  â”‚  â”œâ”€ Redis ì»¨í…Œì´ë„ˆ (í¬íŠ¸: 6379)
â”‚  â”‚  â””â”€ ë¸”ë¡ìŠ¤í† ë¦¬ì§€ (/mnt/blockstorage/projects/commerce/)
â”‚  â”‚
â”‚  â””â”€ í”„ë¡œì íŠ¸C/
â”‚     â”œâ”€ PostgreSQL ì»¨í…Œì´ë„ˆ (í¬íŠ¸: 5434)
â”‚     â””â”€ Redis ì»¨í…Œì´ë„ˆ (í¬íŠ¸: 6381)
â”‚
â”œâ”€ PowerDNS (í†µí•© ë„ë©”ì¸ ê´€ë¦¬)
â””â”€ í”„ë¡œì íŠ¸ë³„ í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬
```

### í˜„ì¬ í”„ë¡œì íŠ¸ ë¦¬ì†ŒìŠ¤
- **PostgreSQL**: `nextjs_production` DB (í¬íŠ¸ 5432)
- **Redis**: ì¸ì¦í‚¤ `hFAqbBwwLkzOMO4QEsGsw5Jck` (í¬íŠ¸ 6379)
- **ë¸”ë¡ ìŠ¤í† ë¦¬ì§€**: `/mnt/blockstorage/projects/commerce/` (98GB)
- **ê²©ë¦¬ í™˜ê²½**: ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì™€ ì™„ì „ ë…ë¦½

---

## ğŸ”§ êµ¬ì¶• ê³¼ì • ìƒì„¸

### 1. í™˜ê²½ ë¶„ì„ ë° ì„¤ì •

#### ì„œë²„ ë¦¬ì†ŒìŠ¤ í™•ì¸
```bash
# SSH ì ‘ì†ìœ¼ë¡œ ì„œë²„ í™˜ê²½ ë¶„ì„
ssh root@141.164.60.51

# ìŠ¤í† ë¦¬ì§€ í™•ì¸
df -h /mnt/blockstorage
# ê²°ê³¼: 98GB ë¸”ë¡ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš© ê°€ëŠ¥

# Podman ì»¨í…Œì´ë„ˆ í™•ì¸
podman ps -a
```

#### í™˜ê²½ë³€ìˆ˜ ì„¤ì •
```env
# .env íŒŒì¼
DATABASE_URL=postgresql://nextjs_user:ITeRgI4nxSZCaefOaheYJLnA5@141.164.60.51:5432/nextjs_production
DB_HOST=141.164.60.51
DB_PORT=5432
DB_NAME=nextjs_production
DB_USER=nextjs_user
DB_PASSWORD=ITeRgI4nxSZCaefOaheYJLnA5

REDIS_URL=redis://:hFAqbBwwLkzOMO4QEsGsw5Jck@141.164.60.51:6379
REDIS_HOST=141.164.60.51
REDIS_PORT=6379
REDIS_PASSWORD=hFAqbBwwLkzOMO4QEsGsw5Jck
```

### 2. Drizzle ORM ì„¤ì¹˜ ë° ì„¤ì •

#### íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
npm install drizzle-orm drizzle-kit pg @types/pg dotenv
```

#### Drizzle ì„¤ì •
```typescript
// drizzle.config.ts
import type { Config } from "drizzle-kit";

export default {
  schema: "./drizzle/migrations/schema.ts",
  out: "./drizzle/migrations",
  dialect: "postgresql",
  dbCredentials: {
    url: "postgresql://nextjs_user:ITeRgI4nxSZCaefOaheYJLnA5@141.164.60.51:5432/nextjs_production",
  },
} satisfies Config;
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

#### ë¡œì»¬ ìŠ¤í‚¤ë§ˆ ì¶”ì¶œ
```bash
# ë¡œì»¬ DBì—ì„œ ìŠ¤í‚¤ë§ˆ ì¶”ì¶œ
npx drizzle-kit introspect --config=drizzle.config.ts
```

#### ì„œë²„ DB ì¤€ë¹„
```bash
# PostgreSQL í™•ì¥ ì„¤ì¹˜
ssh root@141.164.60.51 'PGPASSWORD=ITeRgI4nxSZCaefOaheYJLnA5 psql -U nextjs_user -d nextjs_production -c "CREATE EXTENSION IF NOT EXISTS \"uuid-ossp\"; CREATE EXTENSION IF NOT EXISTS \"pgcrypto\";"'

# ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± í™•ì¸
ssh root@141.164.60.51 'PGPASSWORD=ITeRgI4nxSZCaefOaheYJLnA5 psql -U postgres -c "CREATE DATABASE nextjs_production OWNER nextjs_user;"'
```

#### ìŠ¤í‚¤ë§ˆ ë° ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
npx tsx scripts/migrate-to-server.ts
npx tsx scripts/copy-data-to-server.ts
```

**ë§ˆì´ê·¸ë ˆì´ì…˜ ê²°ê³¼:**
- âœ… **29ê°œ í…Œì´ë¸”** ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ
- âœ… **259ê°œ ë°ì´í„° ë ˆì½”ë“œ** ë³µì‚¬ ì™„ë£Œ
- âœ… í…Œì´ë¸” ëª©ë¡: users, products, categories, orders, language_packs ë“±

### 4. íŒŒì¼ ë™ê¸°í™”

#### ì´ë¯¸ì§€ íŒŒì¼ ì„œë²„ ë™ê¸°í™”
```bash
# rsyncë¡œ ì´ë¯¸ì§€ íŒŒì¼ ë™ê¸°í™”
rsync -avz --progress public/ root@141.164.60.51:/mnt/blockstorage/projects/commerce/public/
```

**ë™ê¸°í™” ê²°ê³¼:**
- âœ… **56ê°œ ì´ë¯¸ì§€ íŒŒì¼** (44.9MB)
- âœ… ì„œë²„ ê²½ë¡œ: `/mnt/blockstorage/projects/commerce/public/`

### 5. Drizzle í†µí•©

#### Database í´ë˜ìŠ¤ ì—…ë°ì´íŠ¸
```typescript
// lib/db.ts ì£¼ìš” ë³€ê²½ì‚¬í•­
import { drizzle } from 'drizzle-orm/node-postgres';
import type { NodePgDatabase } from 'drizzle-orm/node-postgres';
import { sql } from 'drizzle-orm';
import * as schema from '../drizzle/migrations/schema';
import * as relations from '../drizzle/migrations/relations';

class Database {
  private drizzle: NodePgDatabase<typeof schema>;
  
  constructor() {
    this.pool = new Pool(config);
    this.drizzle = drizzle(this.pool, { schema: { ...schema, ...relations } });
  }
  
  public getDrizzle(): NodePgDatabase<typeof schema> {
    return this.drizzle;
  }
  
  public async testDrizzleConnection() {
    // Drizzle ì—°ê²° í…ŒìŠ¤íŠ¸ ë¡œì§
  }
}
```

#### ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ
```bash
npx tsx scripts/test-server-connection.ts
```

**í…ŒìŠ¤íŠ¸ ê²°ê³¼:**
- âœ… ì„œë²„ ì—°ê²° ì„±ê³µ: `nextjs_production` ë°ì´í„°ë² ì´ìŠ¤
- âœ… Drizzle ORM í†µí•©: **27ê°œ í…Œì´ë¸”** ì¸ì‹
- âœ… ë°ì´í„° í™•ì¸: **1ëª… ì‚¬ìš©ì** ë°ì´í„° ì¡´ì¬

---

## ğŸ”„ ê°œë°œ ì›Œí¬í”Œë¡œìš°

### ìŠ¤í‚¤ë§ˆ ê´€ë¦¬
1. **ë¡œì»¬ ê°œë°œ**: Drizzle ìŠ¤í‚¤ë§ˆ íŒŒì¼ë¡œ í…Œì´ë¸” ì •ì˜
   ```typescript
   // drizzle/migrations/schema.ts
   export const newTable = pgTable('new_table', {
     id: uuid('id').defaultRandom().primaryKey(),
     name: varchar('name', { length: 255 }).notNull(),
   });
   ```

2. **ì„œë²„ ë™ê¸°í™”**: Drizzle â†’ SQL ë³€í™˜í•˜ì—¬ ì„œë²„ ì ìš©
   ```bash
   npx drizzle-kit generate  # SQL ìƒì„±
   # ì„œë²„ì— ì§ì ‘ SQL ì ìš©
   ```

### ë¡œì»¬ ë¹Œë“œ ê²€ì¦ (Vercel ìŠ¤íƒ€ì¼)
```bash
# Vercel CLIë¡œ ë¡œì»¬ í…ŒìŠ¤íŠ¸ (ë°°í¬ ì—†ìŒ)
npm i -g vercel
vercel build --prod    # í”„ë¡œë•ì…˜ ë¹Œë“œë§Œ
vercel dev            # Vercel í™˜ê²½ ì‹œë®¬ë ˆì´ì…˜

# ë˜ëŠ” Next.js ì§ì ‘ ë¹Œë“œ
npm run build:check
npm run typecheck
npm run lint:strict
```

### ê°œë°œ â†’ í”„ë¡œë•ì…˜ ë°°í¬
```
ë¡œì»¬ ê°œë°œ â†’ Vercel CLI ê²€ì¦ â†’ Git Push â†’ ì„œë²„ ë¹Œë“œ â†’ Podman ë°°í¬
```

---

## ğŸ“Š ìµœì¢… êµ¬ì¶• ê²°ê³¼

### âœ… ì™„ì„±ëœ í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œ

| êµ¬ë¶„ | í™˜ê²½ | ì—­í•  |
|------|------|------|
| **ë¡œì»¬** | Next.js + Drizzle | ì½”ë”©, ìŠ¤í‚¤ë§ˆ ì •ì˜, ë¹Œë“œ ê²€ì¦ |
| **ì„œë²„** | PostgreSQL + Redis + Storage | ëª¨ë“  ë°ì´í„° ë° ì¸í”„ë¼ |

### âœ… ì£¼ìš” ì„±ê³¼
- **ë°ì´í„°ë² ì´ìŠ¤**: ë¡œì»¬ â†’ ì„œë²„ ì™„ì „ ë§ˆì´ê·¸ë ˆì´ì…˜
- **ìŠ¤í‚¤ë§ˆ ê´€ë¦¬**: Drizzle ORM íƒ€ì… ì•ˆì „ì„±
- **íŒŒì¼ ìŠ¤í† ë¦¬ì§€**: ì„œë²„ ë¸”ë¡ ìŠ¤í† ë¦¬ì§€ í™œìš©
- **ê²©ë¦¬ í™˜ê²½**: í”„ë¡œì íŠ¸ë³„ ë…ë¦½ëœ ë¦¬ì†ŒìŠ¤
- **ë¹Œë“œ ê²€ì¦**: Vercel CLIë¡œ ë¡œì»¬ í…ŒìŠ¤íŠ¸

### âœ… ê°œë°œ íš¨ìœ¨ì„±
- **Supabase ìˆ˜ì¤€**: BaaS ê²½í—˜ê³¼ ë™ì¼
- **ë¹„ìš© íš¨ìœ¨**: ìì²´ ì„œë²„ í™œìš©
- **í™•ì¥ì„±**: Podman ê¸°ë°˜ ë©€í‹° í”„ë¡œì íŠ¸
- **ê°œë°œ ì†ë„**: ë¡œì»¬ ê°œë°œ + ì„œë²„ ë¦¬ì†ŒìŠ¤

---

## ğŸ”§ ìœ ì§€ë³´ìˆ˜ ê°€ì´ë“œ

### ì •ê¸° ì ê²€ í•­ëª©
1. **ì„œë²„ ì—°ê²° ìƒíƒœ**
   ```bash
   npx tsx scripts/test-server-connection.ts
   ```

2. **ìŠ¤í† ë¦¬ì§€ ìš©ëŸ‰**
   ```bash
   ssh root@141.164.60.51 'df -h /mnt/blockstorage'
   ```

3. **Podman ì»¨í…Œì´ë„ˆ ìƒíƒœ**
   ```bash
   ssh root@141.164.60.51 'podman ps -a'
   ```

### ë°±ì—… ì „ëµ
- **ë°ì´í„°ë² ì´ìŠ¤**: ì •ê¸° PostgreSQL ë¤í”„
- **ìŠ¤í† ë¦¬ì§€**: rsync ê¸°ë°˜ íŒŒì¼ ë°±ì—…
- **ì„¤ì •**: í™˜ê²½ë³€ìˆ˜ ë° Podman ì„¤ì • ë°±ì—…

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. **CI/CD êµ¬ì¶•**: Gitea Actions ë˜ëŠ” Jenkins ì„¤ì¹˜
2. **ëª¨ë‹ˆí„°ë§**: ì„œë²„ ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ
3. **ë¡œë“œë°¸ëŸ°ì‹±**: íŠ¸ë˜í”½ ì¦ê°€ ì‹œ ìŠ¤ì¼€ì¼ë§
4. **ë³´ì•ˆ ê°•í™”**: SSL, ë°©í™”ë²½, ì•¡ì„¸ìŠ¤ ì œì–´

---

*êµ¬ì¶• ì¼ì‹œ: 2025ë…„ 9ì›” 4ì¼*  
*í™˜ê²½: Next.js + Drizzle ORM + PostgreSQL + Redis + ë¸”ë¡ ìŠ¤í† ë¦¬ì§€*  
*ì„œë²„: 141.164.60.51 (Podman ê¸°ë°˜ ë©€í‹°í…Œë„ŒíŠ¸)*
# 🌐 언어팩 설정 기반 통합 시스템 설계서

## 📅 작성일: 2025-09-02
## 🎯 목적: 관리자가 언어팩 설정에서 API와 언어를 선택하는 유연한 다국어 시스템

---

## 1. 🎛️ 언어팩 설정 관리 시스템

### 1.1 설정 탭 구조 (`/admin/language-packs?tab=settings`)
```
┌──────────────────────────────────────────────────┐
│              언어팩 설정 관리                       │
├──────────────────────────────────────────────────┤
│                                                  │
│ 📌 기본 언어 설정                                  │
│ ┌────────────────────────────────────┐          │
│ │ 🇰🇷 한국어 (Korean) [기본/변경불가]   │          │
│ └────────────────────────────────────┘          │
│                                                  │
│ 🌍 추가 언어 선택 (최대 5개)                       │
│ ┌────────────────────────────────────┐          │
│ │ ☑️ 🇺🇸 영어 (English)               │          │
│ │ ☑️ 🇯🇵 일본어 (日本語)              │          │
│ │ ☐ 🇨🇳 중국어 (中文)                │          │
│ │ ☐ 🇪🇸 스페인어 (Español)           │          │
│ │ ☐ 🇫🇷 프랑스어 (Français)          │          │
│ │ ☐ 🇩🇪 독일어 (Deutsch)             │          │
│ │ ☐ 🇷🇺 러시아어 (Русский)           │          │
│ │ ☐ 🇻🇳 베트남어 (Tiếng Việt)        │          │
│ │ ☐ 🇹🇭 태국어 (ไทย)                │          │
│ │ ☐ 🇮🇩 인도네시아어 (Bahasa)         │          │
│ └────────────────────────────────────┘          │
│                                                  │
│ 🔧 번역 API 설정                                  │
│ ┌────────────────────────────────────┐          │
│ │ API 제공자:                        │          │
│ │ ⚪ Google Translate API            │          │
│ │ ⚪ DeepL API (추후 지원)            │          │
│ │ ⚪ Papago API (추후 지원)           │          │
│ │ ⚪ 수동 번역만                      │          │
│ │                                    │          │
│ │ API 키: [******************]       │          │
│ │ [연결 테스트]                       │          │
│ └────────────────────────────────────┘          │
│                                                  │
│ 💰 요금 정보                                      │
│ ┌────────────────────────────────────┐          │
│ │ 현재 사용량: 234,567 / 500,000자    │          │
│ │ 예상 월 비용: ₩0 (무료 한도 내)      │          │
│ └────────────────────────────────────┘          │
│                                                  │
│ [설정 저장]                                       │
└──────────────────────────────────────────────────┘
```

### 1.2 언어 설정 데이터 구조
```typescript
// DB: system_settings 테이블
interface LanguageSettings {
  id: string;
  baseLanguage: 'ko';  // 항상 한국어 고정
  enabledLanguages: string[];  // ['en', 'jp'] 등 선택된 언어들
  translationAPI: {
    provider: 'google' | 'deepl' | 'papago' | 'manual';
    apiKey?: string;
    isActive: boolean;
    monthlyUsage: number;
    monthlyLimit: number;
  };
  createdAt: Date;
  updatedAt: Date;
}
```

---

## 2. 🔄 동적 언어 시스템

### 2.1 언어 설정 기반 UI 생성
```typescript
// lib/services/language-config.service.ts
export class LanguageConfigService {
  private settings: LanguageSettings;
  
  async getEnabledLanguages() {
    // DB에서 설정 로드
    this.settings = await this.loadSettings();
    
    // 기본 언어 + 선택된 언어들
    return ['ko', ...this.settings.enabledLanguages];
  }
  
  async getLanguageColumns() {
    const languages = await this.getEnabledLanguages();
    
    // 동적으로 컬럼 생성
    return languages.map(lang => ({
      code: lang,
      name: this.getLanguageName(lang),
      flag: this.getLanguageFlag(lang),
      isBase: lang === 'ko'
    }));
  }
  
  private getLanguageName(code: string) {
    const names = {
      ko: '한국어',
      en: 'English',
      jp: '日本語',
      zh: '中文',
      es: 'Español',
      fr: 'Français',
      de: 'Deutsch',
      ru: 'Русский',
      vi: 'Tiếng Việt',
      th: 'ไทย',
      id: 'Bahasa Indonesia'
    };
    return names[code] || code;
  }
}
```

### 2.2 동적 번역 테이블 생성
```typescript
// 언어 설정에 따라 동적으로 테이블 구조 변경
const DynamicTranslationTable = () => {
  const [languages, setLanguages] = useState<Language[]>([]);
  
  useEffect(() => {
    // 설정된 언어 목록 로드
    loadEnabledLanguages().then(setLanguages);
  }, []);
  
  return (
    <table>
      <thead>
        <tr>
          <th>키</th>
          <th>🇰🇷 한국어 (기본)</th>
          {languages.filter(l => l !== 'ko').map(lang => (
            <th key={lang}>
              {getLanguageFlag(lang)} {getLanguageName(lang)}
            </th>
          ))}
          <th>작업</th>
        </tr>
      </thead>
      <tbody>
        {/* 동적 언어 컬럼 렌더링 */}
      </tbody>
    </table>
  );
};
```

---

## 3. 🤖 조건부 자동 번역

### 3.1 API 설정 기반 번역
```typescript
// lib/services/translation.service.ts
export class TranslationService {
  private apiProvider: string;
  private apiKey: string;
  private enabledLanguages: string[];
  
  async autoTranslate(text: string, sourceLang: string = 'ko') {
    // API 설정 확인
    const settings = await this.getSettings();
    
    if (settings.translationAPI.provider === 'manual') {
      // 수동 번역만 - 자동 번역 비활성화
      return null;
    }
    
    // 활성화된 언어만 번역
    const targetLanguages = settings.enabledLanguages.filter(
      lang => lang !== sourceLang
    );
    
    const translations = {};
    translations[sourceLang] = text;
    
    for (const targetLang of targetLanguages) {
      translations[targetLang] = await this.translateWithAPI(
        text, 
        sourceLang, 
        targetLang
      );
    }
    
    return translations;
  }
  
  private async translateWithAPI(text: string, from: string, to: string) {
    const provider = this.apiProvider;
    
    switch(provider) {
      case 'google':
        return await this.googleTranslate(text, from, to);
      case 'deepl':
        // 추후 구현
        return text;
      case 'papago':
        // 추후 구현
        return text;
      default:
        return text;
    }
  }
}
```

### 3.2 Google Translate API 통합
```typescript
// lib/services/google-translate.service.ts
export class GoogleTranslateService {
  private client: TranslationServiceClient;
  
  // 언어 코드 매핑 (Google API 형식)
  private languageMapping = {
    ko: 'ko',
    en: 'en',
    jp: 'ja',  // Google은 일본어를 'ja'로 사용
    zh: 'zh-CN',
    es: 'es',
    fr: 'fr',
    de: 'de',
    ru: 'ru',
    vi: 'vi',
    th: 'th',
    id: 'id'
  };
  
  async translate(text: string, sourceLang: string, targetLang: string) {
    // API 키 확인
    const settings = await this.getSettings();
    if (!settings.translationAPI.apiKey) {
      throw new Error('API 키가 설정되지 않았습니다');
    }
    
    // 사용량 체크
    if (settings.translationAPI.monthlyUsage >= settings.translationAPI.monthlyLimit) {
      throw new Error('월 사용량 한도 초과');
    }
    
    // 번역 실행
    const result = await this.client.translateText({
      parent: `projects/${process.env.GOOGLE_PROJECT_ID}/locations/global`,
      contents: [text],
      sourceLanguageCode: this.languageMapping[sourceLang],
      targetLanguageCode: this.languageMapping[targetLang]
    });
    
    // 사용량 업데이트
    await this.updateUsage(text.length);
    
    return result.translations[0].translatedText;
  }
}
```

---

## 4. 📝 섹션/헤더/푸터/팝업 통합

### 4.1 동적 언어 입력 폼
```typescript
// components/admin/DynamicLanguageForm.tsx
const DynamicLanguageForm = ({ type, data, onSave }) => {
  const [languages, setLanguages] = useState([]);
  const [translations, setTranslations] = useState({});
  const [activeTab, setActiveTab] = useState('ko');
  
  useEffect(() => {
    // 설정된 언어 로드
    loadEnabledLanguages().then(langs => {
      setLanguages(langs);
      // 각 언어별 초기값 설정
      const init = {};
      langs.forEach(lang => {
        init[lang] = data?.translations?.[lang] || '';
      });
      setTranslations(init);
    });
  }, []);
  
  const handleAutoTranslate = async () => {
    const sourceText = translations[activeTab];
    if (!sourceText) return;
    
    // API 설정 확인
    const settings = await getLanguageSettings();
    if (settings.translationAPI.provider === 'manual') {
      toast.error('자동 번역이 비활성화되어 있습니다');
      return;
    }
    
    // 자동 번역 실행
    const result = await autoTranslate(sourceText, activeTab);
    setTranslations(result);
  };
  
  return (
    <div>
      {/* 언어 탭 - 동적 생성 */}
      <Tabs value={activeTab} onValueChange={setActiveTab}>
        <TabsList>
          {languages.map(lang => (
            <TabsTrigger key={lang} value={lang}>
              {getLanguageFlag(lang)} {getLanguageName(lang)}
              {lang === 'ko' && <Badge>기본</Badge>}
            </TabsTrigger>
          ))}
        </TabsList>
        
        {languages.map(lang => (
          <TabsContent key={lang} value={lang}>
            <textarea
              value={translations[lang]}
              onChange={(e) => setTranslations({
                ...translations,
                [lang]: e.target.value
              })}
              placeholder={`${getLanguageName(lang)}로 입력하세요`}
            />
          </TabsContent>
        ))}
      </Tabs>
      
      {/* 자동 번역 버튼 - API 설정 시만 표시 */}
      {settings.translationAPI.provider !== 'manual' && (
        <Button onClick={handleAutoTranslate}>
          현재 탭 기준으로 다른 언어 자동 생성 🔄
        </Button>
      )}
    </div>
  );
};
```

### 4.2 섹션 관리 통합
```typescript
// /admin/ui-config?tab=sections
interface UISection {
  id: string;
  key: string;
  type: string;
  translations: {
    [langCode: string]: {  // 동적 언어 코드
      title: string;
      subtitle?: string;
      description?: string;
    };
  };
}

// 섹션 추가/편집 시
const SectionEditor = ({ section }) => {
  return (
    <DynamicLanguageForm
      type="section"
      data={section}
      onSave={handleSave}
    />
  );
};
```

### 4.3 헤더/푸터 통합
```typescript
// 헤더 메뉴 구조
interface MenuItem {
  id: string;
  href: string;
  translations: {
    [langCode: string]: string;  // 동적 언어
  };
}

// 푸터 컬럼 구조
interface FooterColumn {
  id: string;
  translations: {
    [langCode: string]: {
      title: string;
    };
  };
  links: FooterLink[];
}
```

### 4.4 팝업 알림 통합
```typescript
// 기존 구조 개선
interface PopupAlert {
  id: string;
  translations: {
    [langCode: string]: string;  // 동적 언어로 변경
  };
  // 기존 message_ko, message_en, message_jp 마이그레이션
}
```

---

## 5. 🗄️ DB 스키마 설계

### 5.1 언어 설정 테이블
```sql
-- 언어 설정 테이블
CREATE TABLE language_settings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  base_language VARCHAR(5) DEFAULT 'ko',
  enabled_languages JSONB DEFAULT '[]',
  translation_api JSONB DEFAULT '{}',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 초기 데이터
INSERT INTO language_settings (
  base_language,
  enabled_languages,
  translation_api
) VALUES (
  'ko',
  '[]',  -- 추가 언어 없음 (관리자가 선택해야 함)
  '{
    "provider": "manual",
    "apiKey": null,
    "isActive": false,
    "monthlyUsage": 0,
    "monthlyLimit": 500000
  }'
);
```

### 5.2 언어팩 테이블 (동적 구조)
```sql
-- 언어팩 테이블
CREATE TABLE language_packs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  key VARCHAR(255) UNIQUE NOT NULL,
  category VARCHAR(50),
  translations JSONB NOT NULL,  -- {"ko": "텍스트", "en": "Text", ...}
  auto_translated BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

---

## 6. 🔄 마이그레이션 전략

### 6.1 기존 데이터 마이그레이션
```typescript
// 기존 하드코딩된 ko, en, jp를 동적 구조로 변환
const migrateExistingData = async () => {
  // 1. 기존 팝업 알림 마이그레이션
  const popups = await query('SELECT * FROM popup_alerts');
  for (const popup of popups) {
    const translations = {
      ko: popup.message_ko,
      ...(popup.message_en && { en: popup.message_en }),
      ...(popup.message_jp && { jp: popup.message_jp })
    };
    
    await query(
      'UPDATE popup_alerts SET translations = $1 WHERE id = $2',
      [translations, popup.id]
    );
  }
  
  // 2. UI 섹션 마이그레이션
  // 3. 헤더/푸터 마이그레이션
  // ... 동일한 방식으로 처리
};
```

### 6.2 백워드 호환성
```typescript
// 기존 API와 호환성 유지
const getTranslation = (data: any, lang: string) => {
  // 새 구조 확인
  if (data.translations && data.translations[lang]) {
    return data.translations[lang];
  }
  
  // 기존 구조 폴백
  const oldFieldMap = {
    ko: 'message_ko',
    en: 'message_en',
    jp: 'message_jp'
  };
  
  return data[oldFieldMap[lang]] || data.message || '';
};
```

---

## 7. 📊 관리자 대시보드

### 7.1 언어팩 메인 페이지
```
/admin/language-packs

┌────────────────────────────────────────────┐
│ [번역 관리] [설정] [통계] [가져오기/내보내기]   │
├────────────────────────────────────────────┤
│                                            │
│ 현재 언어: 🇰🇷 한국어 + 🇺🇸 영어           │
│ API 상태: ✅ Google Translate 연결됨        │
│                                            │
│ ┌──────┬─────────┬─────────┬──────┐      │
│ │ 키   │ 한국어   │ 영어     │ 작업  │      │
│ ├──────┼─────────┼─────────┼──────┤      │
│ │hero. │환영합니다 │Welcome  │ [✏️] │      │
│ │title │         │         │      │      │
│ └──────┴─────────┴─────────┴──────┘      │
│                                            │
│ [새 항목 추가] [일괄 자동 번역]              │
└────────────────────────────────────────────┘
```

### 7.2 통계 대시보드
```typescript
// 번역 통계 표시
const TranslationStats = () => {
  const [stats, setStats] = useState({
    totalKeys: 0,
    translatedKeys: {},
    apiUsage: 0,
    apiLimit: 500000
  });
  
  return (
    <div>
      <h3>번역 현황</h3>
      <p>전체 키: {stats.totalKeys}개</p>
      {Object.entries(stats.translatedKeys).map(([lang, count]) => (
        <p key={lang}>
          {getLanguageName(lang)}: {count}/{stats.totalKeys} 
          ({Math.round(count/stats.totalKeys * 100)}%)
        </p>
      ))}
      
      <h3>API 사용량</h3>
      <ProgressBar 
        value={stats.apiUsage} 
        max={stats.apiLimit}
        label={`${stats.apiUsage.toLocaleString()} / ${stats.apiLimit.toLocaleString()}자`}
      />
    </div>
  );
};
```

---

## 8. 🌏 사용자 언어 선택

### 8.1 동적 언어 선택기
```typescript
// components/LanguageSelector.tsx
const LanguageSelector = () => {
  const [availableLanguages, setAvailableLanguages] = useState(['ko']);
  const { language, setLanguage } = useLanguage();
  
  useEffect(() => {
    // 활성화된 언어만 표시
    fetch('/api/languages/available')
      .then(res => res.json())
      .then(langs => setAvailableLanguages(langs));
  }, []);
  
  return (
    <select value={language} onChange={(e) => setLanguage(e.target.value)}>
      {availableLanguages.map(lang => (
        <option key={lang} value={lang}>
          {getLanguageFlag(lang)} {getLanguageName(lang)}
        </option>
      ))}
    </select>
  );
};
```

### 8.2 언어별 데이터 제공
```typescript
// API 응답 시 설정된 언어만 포함
app.get('/api/ui-sections', async (req, res) => {
  const { lang = 'ko' } = req.query;
  const enabledLanguages = await getEnabledLanguages();
  
  // 요청된 언어가 활성화되지 않은 경우 한국어로 폴백
  const targetLang = enabledLanguages.includes(lang) ? lang : 'ko';
  
  const sections = await getSections();
  const translatedSections = sections.map(section => ({
    ...section,
    // 해당 언어 번역만 반환
    title: section.translations[targetLang]?.title || section.translations.ko.title,
    subtitle: section.translations[targetLang]?.subtitle || section.translations.ko.subtitle
  }));
  
  res.json(translatedSections);
});
```

---

## 9. 🚀 구현 계획

### Phase 1: 설정 시스템 구축 (2일)
- [ ] language_settings 테이블 생성
- [ ] 언어팩 설정 탭 UI 개발
- [ ] API 제공자 선택 기능
- [ ] API 키 관리 및 연결 테스트

### Phase 2: 동적 언어 시스템 (3일)
- [ ] 동적 언어 컬럼 생성
- [ ] 기존 데이터 마이그레이션
- [ ] 백워드 호환성 레이어

### Phase 3: Google API 통합 (2일)
- [ ] Google Translate 서비스 구현
- [ ] 사용량 추적 시스템
- [ ] 에러 처리 및 폴백

### Phase 4: UI 통합 (3일)
- [ ] 섹션 관리 동적 언어 폼
- [ ] 헤더/푸터 동적 언어 폼
- [ ] 팝업 알림 동적 언어 폼
- [ ] 통합 대시보드

### Phase 5: 테스트 및 최적화 (2일)
- [ ] 마이그레이션 테스트
- [ ] 성능 최적화
- [ ] 사용자 언어 전환 테스트

---

## 10. 💰 비용 관리

### 10.1 API 사용량 모니터링
```typescript
// 실시간 사용량 추적
const UsageMonitor = {
  async checkUsage() {
    const settings = await getSettings();
    const { monthlyUsage, monthlyLimit } = settings.translationAPI;
    
    if (monthlyUsage > monthlyLimit * 0.8) {
      // 80% 초과 시 경고
      sendAdminNotification('API 사용량 경고', 
        `월 한도의 ${Math.round(monthlyUsage/monthlyLimit*100)}% 사용`);
    }
    
    if (monthlyUsage >= monthlyLimit) {
      // 한도 초과 시 자동 번역 중지
      await disableAutoTranslation();
    }
  },
  
  async resetMonthlyUsage() {
    // 매월 1일 사용량 초기화
    await query('UPDATE language_settings SET translation_api = 
      jsonb_set(translation_api, \'{monthlyUsage}\', \'0\')');
  }
};
```

---

## 11. ✅ 체크리스트

### 필수 구현
- [ ] 언어팩 설정 탭 (API 선택, 언어 선택)
- [ ] 한국어 기본 언어 고정
- [ ] 동적 언어 시스템
- [ ] Google Translate API 통합
- [ ] 섹션/헤더/푸터/팝업 통합
- [ ] 기존 데이터 마이그레이션
- [ ] 사용량 모니터링

### 선택 구현
- [ ] DeepL API 지원
- [ ] Papago API 지원  
- [ ] 번역 메모리 기능
- [ ] 용어집 관리
- [ ] 번역 품질 평가

---

## 💡 결론

이 설계는 관리자가 언어팩 설정에서 직접 API와 지원 언어를 선택할 수 있는 유연한 시스템입니다.

**핵심 특징:**
1. **한국어 기본**: 한국어는 항상 기본 언어로 고정
2. **동적 언어 지원**: 관리자가 필요한 언어만 선택
3. **API 선택 가능**: Google, DeepL, Papago 중 선택 (또는 수동)
4. **완전 통합**: 섹션, 헤더, 푸터, 팝업 모두 동일한 시스템 사용
5. **비용 관리**: 사용량 모니터링 및 한도 관리

**장점:**
- 불필요한 언어 컬럼 생성 방지
- API 비용 절감 (필요한 언어만 번역)
- 유연한 확장 (새 언어 쉽게 추가)
- 관리자 친화적 인터페이스

이 시스템으로 효율적이고 유연한 다국어 플랫폼을 구축할 수 있습니다.
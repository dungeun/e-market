# 📊 헤더/푸터/카테고리 언어팩 통합 분석 보고서

## 📅 작성일: 2025-09-02
## 🎯 목적: 헤더/푸터 UI Config와 카테고리 대분류의 다국어 통합 시스템 분석

---

## 1. 🔍 현재 시스템 구조 분석

### 1.1 헤더 설정 (`/admin/ui-config?tab=header`)
```typescript
// components/admin/ui-config/HeaderConfigTab.tsx
- SortableMenuItemWithLanguagePack 컴포넌트 사용
- 드래그앤드롭으로 메뉴 순서 변경
- config.header.menus 배열 관리
- 언어팩 연동 부분 구현됨
```

**현재 헤더 메뉴 구조:**
```typescript
interface MenuItem {
  id: string;
  label: string;      // 한국어만 저장
  href: string;
  order: number;
  visible: boolean;
  // translations 필드 없음 ❌
}
```

### 1.2 푸터 설정 (`/admin/ui-config?tab=footer`)
```typescript
// components/admin/ui-config/FooterConfigTab.tsx
- SortableFooterColumn 컴포넌트 사용
- 컬럼별 링크 관리
- config.footer.columns 배열 관리
- 언어팩 미연동 ❌
```

**현재 푸터 구조:**
```typescript
interface FooterColumn {
  id: string;
  title: string;      // 한국어만 저장
  order: number;
  links: FooterLink[];
  // translations 필드 없음 ❌
}
```

### 1.3 카테고리 관리 (`/admin/categories`)
```typescript
// app/api/admin/categories/route.ts
- STATIC_CATEGORIES 하드코딩
- 한국어 이름만 존재
- 다국어 지원 없음 ❌
```

**현재 카테고리 구조:**
```typescript
{
  id: 'CAT-001',
  name: '중고 가전제품',    // 한국어만
  icon: '🏠',
  children: [...]
  // translations 없음 ❌
}
```

---

## 2. 🌐 언어팩 시스템 현황

### 2.1 언어팩 관리 (`/admin/language-packs`)
```
DB: language_packs 테이블
├── key: string (유니크)
├── ko: string
├── en: string  
└── jp: string
```

### 2.2 현재 언어 컨텍스트
- **AdminLanguageContext**: 관리자는 항상 한국어(ko)
- **LanguageContext**: 사용자는 ko/en/jp 선택 가능

---

## 3. 🔄 통합 프로세스 설계

### 3.1 헤더 메뉴 다국어 통합

**Step 1: DB 스키마 확장**
```sql
-- ui_configs 테이블의 config JSONB 구조 변경
{
  "header": {
    "menus": [
      {
        "id": "menu-1",
        "label": "홈",
        "href": "/",
        "order": 1,
        "visible": true,
        "translations": {
          "ko": "홈",
          "en": "Home",
          "jp": "ホーム"
        }
      }
    ]
  }
}
```

**Step 2: 카테고리 연동**
```typescript
// 헤더에 카테고리 자동 추가
const loadCategoriesForHeader = async () => {
  const categories = await fetch('/api/admin/categories');
  const mainCategories = categories.filter(cat => cat.level === 1);
  
  return mainCategories.map(cat => ({
    id: `cat-${cat.id}`,
    label: cat.name,
    href: `/products?category=${cat.slug}`,
    order: cat.menuOrder,
    visible: true,
    translations: {
      ko: cat.name,
      en: cat.nameEn || translateToEn(cat.name),
      jp: cat.nameJp || translateToJp(cat.name)
    }
  }));
};
```

### 3.2 푸터 컬럼 다국어 통합

**Step 1: FooterColumn 인터페이스 확장**
```typescript
interface FooterColumn {
  id: string;
  title: string;
  order: number;
  links: FooterLink[];
  translations: {
    ko: string;
    en: string;
    jp: string;
  };
}

interface FooterLink {
  id: string;
  label: string;
  href: string;
  translations: {
    ko: string;
    en: string;
    jp: string;
  };
}
```

**Step 2: 카테고리 자동 추가 옵션**
```typescript
// 푸터에 인기 카테고리 섹션 추가
const addPopularCategoriesToFooter = async () => {
  const categories = await fetch('/api/admin/categories?popular=true');
  
  return {
    id: 'popular-categories',
    title: '인기 카테고리',
    order: 1,
    translations: {
      ko: '인기 카테고리',
      en: 'Popular Categories',
      jp: '人気カテゴリー'
    },
    links: categories.map(cat => ({
      id: cat.id,
      label: cat.name,
      href: `/products?category=${cat.slug}`,
      translations: {
        ko: cat.name,
        en: cat.nameEn,
        jp: cat.nameJp
      }
    }))
  };
};
```

### 3.3 카테고리 다국어 확장

**Step 1: 카테고리 테이블 스키마 변경**
```sql
ALTER TABLE categories 
ADD COLUMN name_en VARCHAR(255),
ADD COLUMN name_jp VARCHAR(255),
ADD COLUMN description_en TEXT,
ADD COLUMN description_jp TEXT;
```

**Step 2: API 응답 구조 개선**
```typescript
// /api/admin/categories/route.ts
const getCategoriesWithTranslations = async (lang = 'ko') => {
  const categories = await query(`
    SELECT 
      id,
      CASE 
        WHEN $1 = 'en' THEN COALESCE(name_en, name)
        WHEN $1 = 'jp' THEN COALESCE(name_jp, name)
        ELSE name
      END as display_name,
      name as name_ko,
      name_en,
      name_jp,
      slug,
      icon,
      menu_order
    FROM categories
    WHERE is_active = true
    ORDER BY menu_order
  `, [lang]);
  
  return categories;
};
```

---

## 4. 🔗 통합 플로우

### 4.1 전체 데이터 흐름
```
1. 언어팩 생성 (/admin/language-packs)
   ↓
2. 카테고리 번역 추가 (/admin/categories)
   ↓
3. 헤더 메뉴 구성 (/admin/ui-config?tab=header)
   - 수동 메뉴 추가
   - 카테고리 자동 불러오기
   ↓
4. 푸터 컬럼 구성 (/admin/ui-config?tab=footer)
   - 정보 링크 추가
   - 인기 카테고리 자동 추가
   ↓
5. JSON 생성 및 캐싱
   - /public/i18n/{lang}/header.json
   - /public/i18n/{lang}/footer.json
   - /public/i18n/{lang}/categories.json
   ↓
6. 메인페이지 렌더링
   - 현재 언어에 맞는 데이터 표시
```

### 4.2 실시간 동기화
```typescript
// Socket.io 이벤트 추가
socket.on('header:update', (data) => {
  // 헤더 재렌더링
  invalidateHeader();
});

socket.on('footer:update', (data) => {
  // 푸터 재렌더링
  invalidateFooter();
});

socket.on('category:update', (data) => {
  // 카테고리 메뉴 재렌더링
  invalidateCategories();
});
```

---

## 5. 📝 구현 우선순위

### Phase 1: 스키마 확장 (즉시)
1. ✅ categories 테이블에 name_en, name_jp 컬럼 추가
2. ✅ ui_configs의 JSONB에 translations 필드 추가
3. ✅ 번역 API 서비스 연동

### Phase 2: 관리자 UI 개선 (1일)
1. ⏳ HeaderConfigTab에 카테고리 불러오기 버튼 추가
2. ⏳ FooterConfigTab에 카테고리 섹션 추가 옵션
3. ⏳ 각 메뉴/링크에 다국어 입력 필드 추가

### Phase 3: API 통합 (2일)
1. ⏳ /api/admin/categories에 언어 파라미터 지원
2. ⏳ /api/admin/ui-config에 번역 자동 생성
3. ⏳ JSON 파일 생성 자동화

### Phase 4: 프론트엔드 적용 (1일)
1. ⏳ Header 컴포넌트 다국어 렌더링
2. ⏳ Footer 컴포넌트 다국어 렌더링
3. ⏳ 카테고리 메뉴 다국어 표시

---

## 6. 🚀 예상 효과

### 6.1 사용자 경험 개선
- **언어 전환 시**: 헤더/푸터/카테고리 즉시 번역
- **일관성**: 모든 UI 요소가 선택된 언어로 표시
- **SEO 향상**: 다국어 메타데이터 지원

### 6.2 관리자 편의성
- **중앙 관리**: UI Config에서 모든 요소 관리
- **자동 번역**: 번역 API 연동으로 수동 작업 감소
- **실시간 미리보기**: 변경사항 즉시 확인

### 6.3 시스템 효율성
- **캐싱**: JSON 파일로 성능 최적화
- **재사용성**: 언어팩 키 재사용
- **확장성**: 새 언어 추가 용이

---

## 7. ⚠️ 주의사항

1. **번역 품질**: 자동 번역 후 수동 검수 필요
2. **카테고리 동기화**: 카테고리 변경 시 헤더/푸터 자동 업데이트 필요
3. **캐시 무효화**: 언어 전환 시 캐시 갱신 타이밍
4. **폴백 처리**: 번역 없을 경우 기본 언어(ko) 표시

---

## 8. 📋 체크리스트

### 데이터베이스
- [ ] categories 테이블 다국어 컬럼 추가
- [ ] ui_configs JSONB translations 필드 추가
- [ ] language_packs에 헤더/푸터 키 추가

### API
- [ ] /api/admin/categories 다국어 지원
- [ ] /api/admin/ui-config 번역 자동화
- [ ] /api/translations 통합 엔드포인트

### 컴포넌트
- [ ] HeaderConfigTab 카테고리 연동
- [ ] FooterConfigTab 카테고리 연동
- [ ] SortableMenuItemWithLanguagePack 개선

### JSON 생성
- [ ] /public/i18n/{lang}/header.json
- [ ] /public/i18n/{lang}/footer.json
- [ ] /public/i18n/{lang}/categories.json

---

## 9. 💡 결론

현재 시스템은 헤더/푸터/카테고리가 각각 독립적으로 관리되고 있으며, 다국어 지원이 부분적으로만 구현되어 있습니다.

**핵심 개선 사항:**
1. 카테고리 대분류를 헤더 메뉴에 자동 연동
2. 모든 UI 텍스트에 translations 필드 추가
3. 언어 전환 시 실시간 동기화

이 통합을 통해 관리자는 한 곳에서 모든 UI 요소를 다국어로 관리할 수 있게 됩니다.
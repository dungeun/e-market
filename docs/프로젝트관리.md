# 🏗️ 프로젝트 관리 - 서버-로컬 통합 환경

## 📊 서버 환경 분석 (141.164.60.51)

### 🔒 보안 환경변수
```bash
# /root/.env
POSTGRES_PASSWORD=ITeRgI4nxSZCaefOaheYJLnA5
DATABASE_URL=postgresql://nextjs_user:ITeRgI4nxSZCaefOaheYJLnA5@141.164.60.51:5432/nextjs_production
REDIS_PASSWORD=hFAqbBwwLkzOMO4QEsGsw5Jck
REDIS_URL=redis://:hFAqbBwwLkzOMO4QEsGsw5Jck@141.164.60.51:6379
POWERDNS_API_KEY=20a89ca50a07cc62fa383091ac551e057ab1044dd247480002b5c4a40092eed5
```

### 🏗️ 서버 기본 설정
```bash
# /root/server.env
SERVER_IP=141.164.60.51
BASE_DOMAIN=one-q.xyz
API_PORT=3008
STORAGE_BASE=/mnt/blockstorage
PROJECT_BASE=/mnt/blockstorage/projects
```

## 💾 스토리지 아키텍처

### 📂 블록 스토리지 구조 (/dev/vdb - 98GB)
```
/mnt/blockstorage/           (총 4.1GB 사용 / 98GB 가용)
├── projects/    (2.0GB)    # 프로젝트 파일들
│   ├── commerce/           # 우리 프로젝트 (포트: 4000/5000/6000)
│   ├── test-nextjs/
│   ├── video-platform/
│   ├── celly-creative/
│   └── test-cli-project/
├── backups/     (2.1GB)    # 자동 백업 데이터
├── postgres/    (8KB)      # PostgreSQL 설정
├── redis/       (8KB)      # Redis 설정  
├── logs/        (4.7MB)    # 시스템 로그
└── docker-volumes/ (4KB)   # Podman 볼륨
```

### 🎯 Commerce 프로젝트 할당
```json
{
  "id": "236c0959-ed57-4dbd-b0b5-fef332b6c9a2",
  "name": "commerce",
  "template": "nodejs",
  "appPort": 4000,
  "dbPort": 5000,
  "redisPort": 6000,
  "domain": "commerce.codeb.one-q.xyz",
  "storage": "/mnt/blockstorage/projects/commerce",
  "status": "running"
}
```

## 🔧 환경변수 통합 방안

### 로컬 개발 환경 설정
```bash
# .env.development (로컬 개발용)
NODE_ENV=development
PORT=3000

# 서버 DB 연결
DATABASE_URL=postgresql://nextjs_user:ITeRgI4nxSZCaefOaheYJLnA5@141.164.60.51:5432/nextjs_production
DB_HOST=141.164.60.51
DB_PORT=5432
DB_NAME=nextjs_production
DB_USER=nextjs_user
DB_PASSWORD=ITeRgI4nxSZCaefOaheYJLnA5

# 서버 Redis 연결
REDIS_URL=redis://:hFAqbBwwLkzOMO4QEsGsw5Jck@141.164.60.51:6379
REDIS_HOST=141.164.60.51
REDIS_PORT=6379
REDIS_PASSWORD=hFAqbBwwLkzOMO4QEsGsw5Jck

# 서버 스토리지
STORAGE_BASE=/mnt/blockstorage/projects/commerce
UPLOAD_DIR=/mnt/blockstorage/projects/commerce/uploads
PUBLIC_DIR=/mnt/blockstorage/projects/commerce/public

# PowerDNS API (도메인 관리)
POWERDNS_API_KEY=20a89ca50a07cc62fa383091ac551e057ab1044dd247480002b5c4a40092eed5
POWERDNS_SERVER=141.164.60.51
BASE_DOMAIN=one-q.xyz
```

### 프로덕션 배포 설정
```bash
# .env.production (서버 배포용)
NODE_ENV=production
PORT=4000

# Commerce 프로젝트 전용 포트
APP_PORT=4000
DB_PORT=5000
REDIS_PORT=6000
DOMAIN=commerce.codeb.one-q.xyz

# 같은 DB/Redis 사용 (프로덕션 환경)
DATABASE_URL=postgresql://nextjs_user:ITeRgI4nxSZCaefOaheYJLnA5@141.164.60.51:5432/nextjs_production
REDIS_URL=redis://:hFAqbBwwLkzOMO4QEsGsw5Jck@141.164.60.51:6379
```

## 🚀 개발 워크플로우

### 1. 로컬 개발
```bash
# 로컬에서 코딩 및 테스트
npm run dev  # 포트 3000
# ↓ 서버 DB/Redis 연결
# ↓ 서버 스토리지 활용
```

### 2. 서버 배포
```bash
# 서버에 배포
npm run start  # 포트 4000 (서버 설정)
# ↓ commerce.codeb.one-q.xyz 도메인
```

### 3. 데이터베이스 관리
```bash
# 스키마 관리
npm run db:schema    # 스키마 적용
npm run db:seed      # 시드 데이터
npm run db:migrate   # 마이그레이션
```

## 🔍 장점 및 특징

### ✅ 완벽한 인프라 환경
- 98GB 블록스토리지 + PostgreSQL/Redis 통합
- 자동 백업 시스템 (2.1GB 백업 데이터)
- PowerDNS API로 서브도메인 자동 생성

### ✅ 포트 관리 시스템
- Commerce 전용 포트 할당 (4000/5000/6000)
- 프로젝트별 독립된 스토리지 공간
- Podman 컨테이너 오케스트레이션

### ✅ 개발 효율성
- 로컬 코딩 + 서버 리소스 활용
- 실시간 데이터베이스/Redis 연결
- 통합된 파일 스토리지 시스템

## 📝 다음 단계

1. **환경변수 업데이트**: 로컬 .env를 서버 설정에 맞춰 수정
2. **데이터베이스 전략**: Drizzle vs 로컬 SQL 스키마 방식 결정
3. **스토리지 연동**: 서버 파일 업로드/다운로드 기능 구현
4. **모니터링 설정**: 서버 리소스 사용량 추적